<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Fichero de configuraci&oacute;n del complemento (&gt;=1.1.x)</title>

 </head>
 <body><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="mysqlnd-ms.configuration.html">Configuraci&oacute;n en tiempo de ejecuci&oacute;n</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="mysqlnd-ms.constants.html">Constantes predefinidas</a></div>
 <div class="up"><a href="mysqlnd-ms.setup.html">Instalaci&oacute;n/Configuraci&oacute;n</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="mysqlnd-ms.plugin-ini-json" class="section">
  <h2 class="title">Fichero de configuración del complemento (&gt;=1.1.x)</h2>
  
  <p class="para">
   La siguiente documentación se aplica a PECL/mysqlnd_ms &gt;= 1.1.0-beta.
   No es válida para versiones anteriores. Para la documentación que cubre versiones
   anterires, ver la documentación de configuración
   para <a href="mysqlnd-ms.plugin-ini-json.html#mysqlnd-ms.plugin-ini-v1" class="link">mysqlnd_ms 1.0.x y anteriores</a>.
  </p>
  
  <div class="section" id="mysqlnd-ms.plugin-ini-json-introduction">
   <h2 class="title">Introdución</h2>
   
   
   <blockquote class="note"><p><strong class="note">Nota</strong>: 
    <strong>Registro de cambios: Característica añadida en PECL/mysqlnd_ms 1.1.0-beta</strong><br />
    <p class="para">
     La descripción de abajo se aplica a PECL/mysqlnd_ms &gt;= 1.1.0-beta.
     No es válida para versiones anteriores.
    </p>
   </p></blockquote>
   
   <p class="para">
    El complemento usa su propio fichero de configuración. Este
    guarda información sobre el servidor maestro de replicación MySQL,
    los servidores esclavos de replicación MySQL, la política de elección (equilibrado de carga),
    la estrategia de tolerancia a fallos, y el uso de conexiones retardadas.
   </p>
   <p class="para">
    El complemento carga su fichero de configuración al comienzo de una petición web.
    Entonces, es almacenado en la memoria caché y utilizado durante el resto de la petición web.
    De esta forma, no hay necesidad de reiniciar PHP después de utilizar el fichero de
    configuración. Los cambios de éste estarán activos casi instantáneamente.
   </p>
   <p class="para">
    La directiva de configuración de PHP
    <a href="mysqlnd-ms.configuration.html#ini.mysqlnd-ms.config-file" class="link"><em>mysqlnd_ms.config_file</em></a>
    se utiliza para establecer el fichero de configuración del complemento. Observe que
    dicha direcitiva no puede ser evaluada para cada petición web.
    Por lo tanto, el cambio del nombre del fichero de configuración del complemento o de su ubicación puede
    requerir el reinicio de PHP. Sin embargo, no es necesario tal reinicio para leer los cambios si
    se actualiza un fichero de configuración del complemento ya existente.
   </p>
   <p class="para">
    El uso y el análisis de <acronym title="JavaScript Object Notation">JSON</acronym> es eficiente, ya que con <acronym title="JavaScript Object Notation">JSON</acronym>
    es más sencillo expresar estructuras de datos jerárquicas que con el formato estándar de
    <var class="filename">php.ini</var>.
   </p>
   <p class="para">
    <div class="example" id="example-2032">
     <p><strong>Ejemplo #1 Convertir un array de PHP (hash) al formato JSON</strong></p>
     <div class="example-contents"><p>
      O alternativamente, un desarrollador puede preferir la sintaxis de <span class="type"><a href="language.types.array.html" class="type array">array</a></span>s por estar
      más familiarizado con ella. Este ejemplo demuestra cómo un desarrolador podría convertir un
      array de PHP a <acronym title="JavaScript Object Notation">JSON</acronym>.
     </p></div>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$config&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;</span><span style="color: #DD0000">"myapp"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"master"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"master_0"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"host"&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"socket"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"/tmp/mysql.sock"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),<br />&nbsp;&nbsp;&nbsp;&nbsp;),<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"slave"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(),<br />&nbsp;&nbsp;),<br />);<br /><br /></span><span style="color: #0000BB">file_put_contents</span><span style="color: #007700">(</span><span style="color: #DD0000">"mysqlnd_ms.ini"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_PRETTY_PRINT</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"mysqlnd_ms.ini&nbsp;file&nbsp;created...\n"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Dumping&nbsp;file&nbsp;contents...\n"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">str_repeat</span><span style="color: #007700">(</span><span style="color: #DD0000">"-"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">80</span><span style="color: #007700">));<br />echo&nbsp;</span><span style="color: #0000BB">file_get_contents</span><span style="color: #007700">(</span><span style="color: #DD0000">"mysqlnd_ms.ini"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"\n%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">str_repeat</span><span style="color: #007700">(</span><span style="color: #DD0000">"-"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">80</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

     <div class="example-contents"><p>El resultado del ejemplo sería:</p></div>
     <div class="example-contents screen">
<div class="cdata"><pre>
mysqlnd_ms.ini file created...
Dumping file contents...
--------------------------------------------------------------------------------
{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;,
                &quot;socket&quot;: &quot;\/tmp\/mysql.sock&quot;
            }
        },
        &quot;slave&quot;: [

        ]
    }
}
--------------------------------------------------------------------------------
</pre></div>
     </div>
    </div>
   </p>
   <p class="para">
    Un fichero de configuración del complemento consta de una o más secciones. Éstas
    están representadas por las propiedades de nivel superior del
    objeto codificado en el fichero <acronym title="JavaScript Object Notation">JSON</acronym>. Las secciones también podrían
    llamarse <em class="emphasis">nombres de configuración</em>.
   </p>
   <p class="para">
    Las aplicciones hacen referencia a las secciones por su nombre. Las aplicaciones usan los nombres de las
    secciones como el parámetro &#039;host&#039; (servidor) de los distintos métodos de conexión de las extensiones
    <a href="ref.mysqli.html" class="link">mysqli</a>,
    <a href="ref.mysql.html" class="link">mysql</a> y
    <a href="ref.pdo-mysql.html" class="link">PDO_MYSQL</a>. Durante la conexión,
    el complemento de <a href="book.mysqlnd.html" class="link">mysqlnd</a> compara el nombre del equipo anfitrión
    con todos los nombres de las secciones del fichero de configuración del complemento. Si el nombre del
    equipo anfitrión y el nombre de la sección coinciden, el complemento cargará la configuración de esa sección.
   </p>
   <p class="para" id="mysqlnd-ms.plugin-ini-json.using-section">
    <div class="example" id="example-2033">
     <p><strong>Ejemplo #2 Ejemplo del uso de nombres de sección</strong></p>
     <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.2.27&quot;
            },
            &quot;slave_1&quot;: {
                &quot;host&quot;: &quot;192.168.2.27&quot;,
                &quot;port&quot;: 3306
            }
        }
    },
    &quot;localhost&quot;: {
        &quot;master&quot;: [
            {
                &quot;host&quot;: &quot;localhost&quot;,
                &quot;socket&quot;: &quot;\/path\/to\/mysql.sock&quot;
            }
        ],
        &quot;slave&quot;: [
            {
                &quot;host&quot;: &quot;192.168.3.24&quot;,
                &quot;port&quot;: &quot;3305&quot;
            },
            {
                &quot;host&quot;: &quot;192.168.3.65&quot;,
                &quot;port&quot;: &quot;3309&quot;
            }
        ]
    }
}</pre>
</div>
     </div>

     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;Todas&nbsp;las&nbsp;conexiones&nbsp;siguientes&nbsp;tendrán&nbsp;equilibrado&nbsp;de&nbsp;carga&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"myapp"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"nombre_usuario"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"contraseña"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"base_datos"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$pdo&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #DD0000">'mysql:host=myapp;dbname=base_datos'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'nombre_usuario'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'contraseña'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"myapp"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"nombre_usuario"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"contraseña"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"nombre_usuario"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"contraseña"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"base_datos"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
   </p>
   <p class="para">
    Los nombres de sección son cadenas de texto. Es válido usar nombres de sección como
    <em>192.168.2.1</em>, <em>127.0.0.1</em> o
    <em>localhost</em>. Si, por ejemplo, una aplicación
    se conexta a <em>localhost</em> y existe una sección de configuración
    del complemento llamada <em>localhost</em>, la
    semántica de la operación de conexión se cambia. La aplicación ya
    no usará únicamente el servidor MySQL que se ejecuta en el equipo anfitrión
    <em>localhost</em>, sino que el complemento iniciará el equilibrado de carga
    de las consultas MySQL siguiendo las reglas de la sección de configuración
    <em>localhost</em>. De esta manera se puede realizar el equilibrado de carga de consultas
    desde una aplicación sin cambiar el código fuente de la misma.
    Recuerde que tal configuración puede no contribuir a la
    legibilidad global del código fuente de las aplicaciones. El uso de nombres de sección
    combinado con nombres de equipos anfitriones debería ser el último recurso.
   </p>
   <p class="para" id="mysqlnd-ms.plugin-ini-json.server-list-syntax">
    Cada sección de configuración contiene, como mínimo, una lista de sevidores maestros
    y una lista de servidores esclavos. La lista de maestros se configura con la palabra clave
    <em>master</em>, mientras que la lista de esclavos se configura con la
    palabra clave <em>slave</em>. El no proporcionar una lista de esclavos resultará
    en un error fatal de nivel <strong><code>E_ERROR</code></strong>, aunque la lista de esclavos
    puede estar vacía. Es posible prohibir esclavos. Sin embargo, esto solo se recomienda
    para clústeres sincrónicos. Véanse también los
    <a href="mysqlnd-ms.supportedclusters.html" class="link">clústeres admitidos</a>.
    La parte principal de esta documentación se centra en el uso de
    clústeres de replicación MySQL asincrónicos.
   </p>
   <p class="para">
    Las listas de servidores maestros y esclavos se pueden indexar opcionalmente mediante nombres
    simbólicos para los servidores que describen. De forma alternativa, se puede utlizar un array
    con descripciones de los servidores esclavos y maestros.
   </p>
   <p class="para">
    <div class="example" id="example-2034">
     <p><strong>Ejemplo #3 Lista de esclavos anónimos</strong></p>
     <div class="example-contents">
<div class="inicode"><pre class="inicode">&quot;slave&quot;: [
    {
        &quot;host&quot;: &quot;192.168.3.24&quot;,
        &quot;port&quot;: &quot;3305&quot;
    },
    {
        &quot;host&quot;: &quot;192.168.3.65&quot;,
        &quot;port&quot;: &quot;3309&quot;
    }
]</pre>
</div>
     </div>

    </div>
   </p>
   <p class="para">
    Una lista de servidores anónimos está codificada por el tipo <em>array de JSON</em>.
    Opcionalmente, se pueden usar los nombres simbólicos para indexar los servidores esclavos o maestros
    de una lista de servidores, realizándolo mediante el tipo <em>objeto de JSON</em>.
   </p>
   <p class="para">
    <div class="example" id="example-2035">
     <p><strong>Ejemplo #4 Lista de maestros usando nombres simbólicos</strong></p>
     <div class="example-contents">
<div class="inicode"><pre class="inicode">&quot;master&quot;: {
    &quot;master_0&quot;: {
        &quot;host&quot;: &quot;localhost&quot;
    }
}</pre>
</div>
     </div>

    </div>
   </p>
   <p class="para">
    Se recomienda indexar las listas de servidores con nombres de servidores simbólicos.
    Los sobrenombres se mostrarán en los mensajes de error.
   </p>
   <p class="para">
    mysqlnd_ms preserva el orden de los servidores y lo toma en cuenta.
    Si, por ejemplo, se configura una estrategia de equilibrado de carga de rotación, la
    primera sentencia <em>SELECT</em> será ejecutada en el esclavo
    que aparece en primer lugar en la lista de servidores esclavos.
   </p>
   <p class="para">
    Un servidor configurado puede ser descrito con <em>host</em>,
    <em>port</em>, <em>socket</em>, <em>db</em>,
    <em>user</em>, <em>password</em> y <em>connect_flags</em>.
    Es obligatorio establecer el equipo anfitrión del servidor de la base de datos mediante la palabra clave
    <em>host</em>. Todos los demás ajustes son opcionales.
   </p>
   <p class="para">
    <div class="example" id="example-2036">
     <p><strong>Ejemplo #5 Palabras clave para configurar un servidor</strong></p>
     <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;db_server_host&quot;,
                &quot;port&quot;: &quot;db_server_port&quot;,
                &quot;socket&quot;: &quot;db_server_socket&quot;,
                &quot;db&quot;: &quot;database_resp_schema&quot;,
                &quot;user&quot;: &quot;user&quot;,
                &quot;password&quot;: &quot;password&quot;,
                &quot;connect_flags&quot;: 0
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;db_server_host&quot;,
                &quot;port&quot;: &quot;db_server_port&quot;,
                &quot;socket&quot;: &quot;db_server_socket&quot;
            }
        }
    }
}</pre>
</div>
     </div>

    </div>
   </p>
   <p class="para">
    Si se omite un ajuste, el complemento usará el valor proporcionado por la llamada a la API
    hecha por el usuario utilizada para abrir la conexión. Véase el
    <a href="mysqlnd-ms.plugin-ini-json.html#mysqlnd-ms.plugin-ini-json.using-section" class="link">ejemplo de uso de nombres de sección</a> de arriba.
   </p>
   <p class="para">
    El formato del fichero de configuración ha sido cambiado en la versión 1.1.0-beta para tener en cuenta
    los filtros encadencados. Los filtros son los responsables de filtrar la lista de servidores configurados
    para identificar un servidor para que ejecute una sentencia dada.
    Los filtros se configuran con la palabra clave <em>filter</em>. Éstos
    son ejecutados por mysqlnd_ms en el orden en que aparecen.
    La definción de filtros es opcional. Una sección de configuración del fichero de
    configuración del complemento no necesita tener una entrada <em>filters</em>.
   </p>
   <p class="para">
    Los filtros reemplazan al ajuste
    <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config.pick" class="link"><em>pick[]</em></a>
    de versiones anteriores. Los nuevos filtros <em>random</em> y
    <em>roundrobin</em> proporcionan la misma funcionalidad.
   </p>
   <p class="para">
    <div class="example" id="example-2037">
     <p><strong>Ejemplo #6 El nuevo filtro <em>roundrobin</em>, funcionalidad antigua</strong></p>
     <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.78.136&quot;,
                &quot;port&quot;: &quot;3306&quot;
            },
            &quot;slave_1&quot;: {
                &quot;host&quot;: &quot;192.168.78.137&quot;,
                &quot;port&quot;: &quot;3306&quot;
            }
        },
        &quot;filters&quot;: {
            &quot;roundrobin&quot;: [

            ]
        }
    }
}</pre>
</div>
     </div>

    </div>
   </p>
   <p class="para">
    La función
    <span class="function"><a href="function.mysqlnd-ms-set-user-pick-server.html" class="function">mysqlnd_ms_set_user_pick_server()</a></span>
    ha sido eliminada. El establecimiento de una llamada de retorno ahora se realiza con el filtro
    <em>user</em>. Algunos filtros aceptan parámetros. El filtro <em>user</em>
    requiere y acepta el parámetro obligatorio <em>callback</em>
    para establecer la llamada de retorno que antes se establecía a través de la función <span class="function"><a href="function.mysqlnd-ms-set-user-pick-server.html" class="function">mysqlnd_ms_set_user_pick_server()</a></span>.
    <div class="example" id="example-2038">
     <p><strong>Ejemplo #7 El filtro <em>user</em> reemplaza a <span class="function"><a href="function.mysqlnd-ms-set-user-pick-server.html" class="function">mysqlnd_ms_set_user_pick_server()</a></span></strong></p>
     <div class="example-contents">
<div class="inicode"><pre class="inicode">&quot;filters&quot;: {
    &quot;user&quot;: {
        &quot;callback&quot;: &quot;pick_server&quot;
    }
}</pre>
</div>
     </div>

    </div>
   </p>
   <p class="para" id="mysqlnd-ms.plugin-ini-json.debug_config">
    La validez del fichero de configuración se realiza tanto al leerlo
    como cuando más tarde se establece una conexión. El fichero de
    configuración se lee durante la petición de arranque de PHP. En esta primera etapa, una extensión de PHP
    podría no mostrar mensajes de error apropiadamente. En el peor de los casos, no se mostrará
    ningún error y un intento de conexión fallará sin un mensaje de error adecuado.
    Este problema ha sido solventado en la versión 1.5.0.
   </p>
   <p class="para">
    <div class="example" id="example-2039">
     <p><strong>Ejemplo #8 Mensaje de error común en caso de problemas con el fichero de configuración (hasta la versión 1.5.0)</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"myapp"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"username"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"database"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

     <div class="example-contents"><p>El resultado del ejemplo sería:</p></div>
     <div class="example-contents screen">
<div class="cdata"><pre>
Warning: mysqli::mysqli(): (mysqlnd_ms) (mysqlnd_ms) Failed to parse config file [s1.json]. Please, verify the JSON in Command line code

Warning: mysqli::mysqli(): (HY000/2002): php_network_getaddresses: getaddrinfo failed: Name or service not known in Command line code on line 1

Warning: mysqli::query(): Couldn&#039;t fetch mysqli in Command line code on line 1

Fatal error: Call to a member function fetch_assoc() on a non-object in Command line code on line 1
</pre></div>
     </div>
    </div>
   </p>
   <p class="para">
    Desde la versión 1.5.0, los errores al arrancar son además almacenados en búfer y emitidos cuando
    se realiza un intento de conexión. Use la directiva de configuración
    <a href="mysqlnd-ms.configuration.html#ini.mysqlnd-ms.force-config-usage" class="link"><em>mysqlnd_ms.force_config_usage</em></a>
    para establecer el tipo de error usado para mostrar errores almacenados en búfer. Por omisión, se emitirá
    un error de tipo <em>E_WARNING</em>.
   </p>
   <p class="para">
    <div class="example" id="example-2040">
     <p><strong>Ejemplo #9 Validación mejorada del fichero de configuración desde 1.5.0</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"myapp"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"username"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"database"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

     <div class="example-contents"><p>El resultado del ejemplo sería:</p></div>
     <div class="example-contents screen">
<div class="cdata"><pre>
Warning: mysqli::mysqli(): (mysqlnd_ms) (mysqlnd_ms) Failed to parse config file [s1.json]. Please, verify the JSON in Command line code on line 1
</pre></div>
     </div>
    </div>
   </p>
   <p class="para">
    Puede ser útil establecer <a href="mysqlnd-ms.configuration.html#ini.mysqlnd-ms.force-config-usage" class="link"><em>mysqlnd_ms.force_config_usage = 1</em></a>
    al depurar errores potenciales del fichero de configuración. Esto no solo convertirá el tipo de errores
    del arranque almacenados en búfer a <em>E_RECOVERABLE_ERROR</em>, sino que también
    ayudará a detectar nombres de seccones mal escritas.
   </p>
   <p class="para">
    <div class="example" id="example-2041">
     <p><strong>Ejemplo #10 Error posiblemente más preciso debido a <em>mysqlnd_ms.force_config_usage=1</em></strong></p>
     <div class="example-contents">
<div class="inicode"><pre class="inicode">mysqlnd_ms.force_config_usage=1</pre>
</div>
     </div>

     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"invalid_section"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"username"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"database"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

     <div class="example-contents"><p>El resultado del ejemplo sería:</p></div>
     <div class="example-contents screen">
<div class="cdata"><pre>
Warning: mysqli::mysqli(): (mysqlnd_ms) Exclusive usage of configuration enforced but did not find the correct INI file section (invalid_section) in Command line code on line 1 line 1
</pre></div>
     </div>
     
    </div>
   </p>
  </div>
  
  <div class="section" id="mysqlnd-ms.plugin-ini-json-reference">
   <h2 class="title">Directivas de configuración</h2>
   
   <p class="para">
    He aquí una breve explicación de las directivas de configuración que se pueden usar.
   </p>
   <p class="para">
    <dl>

     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.master">
       <code class="parameter">master</code>
       <span class="type"><span class="type array o object">array o object</span></span>
      </dt>

      <dd>

       <p class="para">
        Lista de los servidores maestros de replicación MySQL. La lista es
        del tipo <em>array de JSON</em>, para declarar una lista anónima
        de servidores, o del tipo <em>objeto de JSON</em>.
        Por favor, véanse los
        <a href="mysqlnd-ms.plugin-ini-json.html#mysqlnd-ms.plugin-ini-json.server-list-syntax" class="link">ejemplos de arriba</a>.
       </p>
       <p class="para">
        Es obligatorio establecer al menos un servidor maestro. El complemento emitirá un
        error de tipo <em>E_ERROR</em> si el usuario no ha proporcionado
        una lista de servidores maestros en una sección de configuración.
        El error fatal puede ser
        <em>(mysqlnd_ms) Section [master] doesn&#039;t exist for host [name_of_a_config_section] in %s on line %d</em>
        ((mysqlnd_ms) La sección [master] no existe para el equipo anfitrión [nombre_de_una_sección_de_configurción] en %s en la línea %d).
       </p>
       <p class="para">
        Un servidor se describe con las palabras clave
        <em>host</em>, <em>port</em>,
        <em>socket</em>, <em>db</em>,
        <em>user</em>, <em>password</em> y
        <em>connect_flags</em>. Es obligatorio
        proporcionar al menos un valor para <em>host</em>. Si no se proporcionan
        cualesquiera de los otros valores, se tomarán de la llamada de conexión del usuario
        a la API, véase también:
        <a href="mysqlnd-ms.plugin-ini-json.html#mysqlnd-ms.plugin-ini-json.using-section" class="link">ejemplo de uso de nombres de sección</a>.
       </p>
       <p class="para" id="mysqlnd-ms.plugin-ini-json.server-config-keywords">
        Tabla de las palabras clave de configuración del servidor.
       </p>
       <table class="doctable informaltable">
        
         <col width="1*" />
         <col width="7*" />
         <col width="2*" />
         <thead>
          <tr>
           <th>Palabra clave</th>
           <th>Descripción</th>
           <th>Versión</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td>
            <em>host</em>
           </td>
           <td>
            <p class="para">
             El equipo anfitrión servidor de las bases de datos. Es un ajuste obligatorio.
             Si no se proporcina causará un error de tipo <em>E_RECOVERABLE_ERROR</em>
             cuando el complemento intente conectarse al servidor. El mensaje de error puede ser
             <em>(mysqlnd_ms) Cannot find [host] in [%s] section in config in %s on line %d</em>
             ((mysqlnd_ms) No se pudo encontrar [host] en la sección [%s] de configuración en %s en la línea %d).
            </p>
           </td>
           <td>Desde 1.1.0.</td>
          </tr>

          <tr>
           <td>
            <em>port</em>
           </td>
           <td>
            <p class="para">
             El puerto TCP/IP del servidor de las bases de datos.
            </p>
           </td>
           <td>Desde 1.1.0.</td>
          </tr>

          <tr>
           <td>
            <em>socket</em>
           </td>
           <td>
            <p class="para">
             El socket de dominio Unix del servidor de las bases de datos.
            </p>
           </td>
           <td>Desde 1.1.0.</td>
          </tr>

          <tr>
           <td>
            <em>db</em>
           </td>
           <td>
            <p class="para">
             La base de datos (esquema).
            </p>
           </td>
           <td>Desde 1.1.0.</td>
          </tr>

          <tr>
           <td>
            <em>user</em>
           </td>
           <td>
            <p class="para">
             El usuario de la base de datos MySQL.
            </p>
           </td>
           <td>Desde 1.1.0.</td>
          </tr>

          <tr>
           <td>
            <em>password</em>
           </td>
           <td>
            <p class="para">
             La constraseña del usuario de la base de datos MySQL.
            </p>
           </td>
           <td>Desde 1.1.0.</td>
          </tr>

          <tr>
           <td>
            <em>connect_flags</em>
           </td>
           <td>
            <p class="para">
             Banderas de conexión.
            </p>
           </td>
           <td>Desde 1.1.0.</td>
          </tr>

         </tbody>
        
       </table>

       <p class="para">
        El complemento únicamente admite el uso de un servidor maestro. Existe un ajuste
        experimental para habilitar el soporte de múltiples maestros. Los detalles no
        están documentados. El ajuste sólo se menciona para desarrollo.
       </p>
      </dd>

     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.slave">
       <code class="parameter">slave</code>
       <span class="type"><span class="type array o object">array o object</span></span>
      </dt>

      <dd>

       <p class="para">
        Lista de uno o más servidores esclavos de replicación MySQL. La sintaxis es
        idéntica a la de lo servidores maestros, véase
        <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config-v2.master" class="link"><em>master</em></a>
        más arriba para más detalles.
       </p>
       <p class="para">
        El complemento admite el uso de uno o más servidores esclavos.
       </p>
       <p class="para">
        Es obligatorio establecer una lista de servidores esclavos. El complemento notificará
        un error de tipo <em>E_ERROR</em> si no se proporciona
        <em>slave</em> para una sección de configuración. El mensaje de error fatal puede ser
        <em>(mysqlnd_ms) Section [slave] doesn&#039;t exist for host [%s] in %s on line %d</em>
        ((mysqlnd_ms) La sección [slave] no existe para el equipo anfitrión [%s] en %s en la línea %d).
        Observe que es válido usar una lista de servidores esclavos vacía.
        Este error ha sido introducido para evitar que no se establezcan esclavos de forma accidental si se olvida el ajuste <em>slave</em>.
        Es posible configurar un único maestro si se utiliza una lista de servidores esclavos vacía.
       </p>
       <p class="para">
        Si se configura una lista de esclavos vacía y se intenta
        ejecutar una sentencia en un esclavo, el complemento podría emitir una advertencia como
        <em>(mysqlnd_ms) Couldn&#039;t find the appropriate slave connection. 0 slaves to choose from.</em>
        ((mysqlnd_ms) No se pudo encontrar la conexión esclava apropiada. 0 esclavos de donde elegir) durante la ejecución de la sentencia.
        Es posible que le siga otra advertencia, como <em>(mysqlnd_ms) No connection selected by the last filter</em>
        ((mysqlnd_ms) El último filtro no seleccionó ninguna conexión).
       </p>
      </dd>

     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.gtid">
       <code class="parameter">global_transaction_id_injection</code>
       <span class="type"><span class="type array o object">array o object</span></span>
      </dt>

      <dd>

       <p class="para">
        La configuración del identificador de transacciones global está relacionada tanto con
        el uso de la característica del ID de transacciones global interno del servidor como con la
        emulación en el lado del cliente.
       </p>
       <table class="doctable informaltable">
        
         <col width="1*" />
         <col width="7*" />
         <col width="2*" />
         <thead>
          <tr>
           <th>Palabra clave</th>
           <th>Descripción</th>
           <th>Versión</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td>
            <em>fetch_last_gtid</em>
           </td>
           <td>
            <p class="para">
             Senetencia SQL para acceder al último identificador de transaccioens global.
             La sentencia SQL se ejecuta si el complemento necesita conocer el identificador de
             transacciones global más reciente. Este puede ser el caso cuando, por ejemplo, se comprueba
             el estado de un esclavo de Replicación MySQL.
             También se usa con <span class="function"><a href="function.mysqlnd-ms-get-last-gtid.html" class="function">mysqlnd_ms_get_last_gtid()</a></span>.
            </p>
           </td>
           <td>Desde 1.2.0.</td>
          </tr>

          <tr>
           <td>
            <em>check_for_gtid</em>
           </td>
           <td>
            <p class="para">
             Sentencia SQL para comprobar si una réplica ha replicado
             todas las transacciones hasta, e incluyendo a, la buscada. La
             sentencia SQL se ejecuta cuando se buscan réplicas que pueden ofrecer
             un nivel mayor de consistencia que la consistencia final.
             La sentencia puede contener el parámetro de sustitución <em>#GTID</em>,
             el cual es reemplazado con el identificador de transacciones global buscado
             por el complemento. Por favor, revise los ejemplos de la
             <a href="mysqlnd-ms.quickstart.gtid.html" class="link">guía rápica</a>.
            </p>
           </td>
           <td>Desde 1.2.0.</td>
          </tr>

          <tr>
           <td>
            <em>report_errors</em>
           </td>
           <td>
            <p class="para">
             Si se ha de emitir un error de tipo &#039;warning&#039; si ocurriera un problema mientras
             se ejecuta cualquiera de las sentencias SQL configuradas.
            </p>
           </td>
           <td>Desde 1.2.0.</td>
          </tr>

          <tr>
           <td>
            <em>on_commit</em>
           </td>
           <td>
            <p class="para">
             (Solamente para la emulación del ID de transacciones global en el lado del cliente). Sentencia SQL
             a ejecutar cuando una transacción finaliza y acutaliza el número de secuencia del
             identificador de transacciones global en el maestro. Por favor, vea los ejemplo de la
             <a href="mysqlnd-ms.quickstart.gtid.html" class="link">guía rápida</a>.
            </p>
           </td>
           <td>Desde 1.2.0.</td>
          </tr>

          <tr>
           <td>
            <em>wait_for_gtid_timeout</em>
           </td>
           <td>
            <p class="para">
             Ordena al complemento que espere hasta <em>wait_for_gtid_timeout</em>
             segundos para que un esclavo se ponga al día cuando se busquen esclavos que puedan
             proporcionar la consistencia de sesión. Este ajuste limita el tiempo empleado en
             obtener el estados de los esclavos. Si dicha obtención toma mucho tiempo, el tiempo de
             espera total empleado puede exceder <em>wait_for_gtid_timeout</em>.
             El complemento llama a <em>sleep(1)</em> para dormir un segundo entre
             cada dos obtenciones.
            </p>
            <p class="para">
             El ajuste se puede usar junto con la emulación en el lado del cliente del complemento
             y la característica del identificador de transacciones global del lado del servidore de MySQL 5.6.
            </p>
            <p class="para">
             La espera de que un esclavo replique un GTID en particular necesario para la consistencia
             de sesión también signifiva estrangular el cliente. El estrangulamiento del
             cliente reduce indirectamente la carga de escrigura del maestro. A un
             sistema de replicación basado en copia primaria,, como la Replicación MySQL,
             se le da más tiempo para alcanzar un estado consistente. Esto puede ser útil,
             por ejemplo, para aumentar el número de copias de datos para
             consideraciones de alta disponibilidad, o para prevenir que el maestro sea
             sobrecargado.
            </p>
           </td>
           <td>Desde 1.4.0.</td>
          </tr>

         </tbody>
        
       </table>

      </dd>

     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.fabric">
       <code class="parameter">fabric</code>
       <span class="type"><a href="language.types.object.html" class="type object">object</a></span>
      </dt>

      <dd>

       <p class="para">
        Ajustes relacionados con MySQL Fabric. Si el complemento se usa junto con MySQL
        Fabric, el fichero de configuración del complemento no contendrá las listas de servidores de MySQL.
        En su lugar, el complemento preguntará a MySQL Fabric sobre qué listas de servidores usar para
        realizar cierta tarea.
       </p>
       <p class="para">
        Una configuración mínima del complemento para usar con MySQL Fabric contendrá una lista
        de uno o más hosts de MySQL Fabric que el complemento puede consultar. Si se configura
        más de un host de MySQL Fabric, el complemento usará una estrategia de rotación
        para elegir entre ellos. No está disponible ninguna otra estrategia actualmente.
       </p>
       <p class="para">
        <div class="example" id="example-2042">
         <p><strong>Ejemplo #11 Configuración mínima del complemento para usar con MySQL Fabric</strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;fabric&quot;: {
            &quot;hosts&quot;: [
                {
                    &quot;host&quot; : &quot;127.0.0.1&quot;,
                    &quot;port&quot; : 8080
                }
            ]
        }
    }
}</pre>
</div>
         </div>

        </div>
       </p>
       <p class="para">
        Cada host de MySQL Fabric está descrito usando un objeto de JSON con los siguientes
        miembros.
       </p>
       <table class="doctable informaltable">
        
         <col width="1*" />
         <col width="7*" />
         <col width="2*" />
         <thead>
          <tr>
           <th>Palabra clave</th>
           <th>Descripción</th>
           <th>Versión</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td>
            <em>host</em>
           </td>
           <td>
            <p class="para">
             Nombre del host de MySQL Fabric.
            </p>
           </td>
           <td>Desde 1.6.0.</td>
          </tr>

          <tr>
           <td>
            <em>port</em>
           </td>
           <td>
            <p class="para">
             El puerto TCP/IP en el que el host de MySQL Fabric escucha
             para llamadas de procedimientos remotos enviados por clientes como
             el complemento.
            </p>
           </td>
           <td>Desde 1.6.0.</td>
          </tr>

         </tbody>
        
       </table>

       <p class="para">
        El complemento utiliza flujos de PHP para comunicarse con MySQL Fabric
        a través de XML RPC sobre HTTP. Por omisión, no se establecen tiempos de espera
        para la comunicación en red. Así, el valor predeterminado del complemento es el tiempo
        de espera predeterminado del flujo de PHP. Dichos valores predeterminados están fuera
        del alcance del complemento.
       </p>
       <p class="para">
        Se puede establecer un tiempo de espera opcional para sobrescribir el predeterminado
        del flujo de PHP. Establecer el tiempo de espera en el fichero de configuración
        del complemento tiene el mismo efecto que
        establecer un tiempo de espera para la conexión HTTP del espacio de usuario de PHP
        establecida a través de flujos de PHP.
       </p>
       <p class="para">
        La unidad del valor del tiempo de espera de Fabric del complemento es el segundo.
        El rango de valores permitidos es de 0 a 65535. Este ajuste existe desde la versión 1.6.
       </p>
       <p class="para">
        <div class="example" id="example-2043">
         <p><strong>Ejemplo #12 Tiempo de espera opcional para la comunicación con Fabric</strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;fabric&quot;: {
            &quot;hosts&quot;: [
                {
                    &quot;host&quot; : &quot;127.0.0.1&quot;,
                    &quot;port&quot; : 8080
                }
            ],
            &quot;timeout&quot;: 2
        }
    }
}</pre>
</div>
         </div>

        </div>
       </p>
       <p class="para">
        La <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config-v2.trx-stickiness" class="link">adhesión de transacciones</a>
        y la lógica de MySQL Fabric puden entrar en conflicto. La opción de adhesión deshabilita el cambio
        entre srevidores durante una transacción. Al usar Fabric y fragmentación,
        el usuario podría (erróneamente) iniciar una transacción local en un fragmento y
        luego intentar cambiar a un fragmento diferente usando
        <span class="function"><a href="function.mysqlnd-ms-fabric-select-shard.html" class="function">mysqlnd_ms_fabric_select_shard()</a></span> o
        <span class="function"><a href="function.mysqlnd-ms-fabric-select-global.html" class="function">mysqlnd_ms_fabric_select_global()</a></span>. En este caso, el
        complemento no rechazará la petición de cambiar de servidor en mitad de una transacción,
        sino que permitirá al usuario cambiar a otro servidor independientemente de la configuración
        de adhesión de transacciones usada. Obviamente, es un error de usuario escribir tal código.
       </p>
       <p class="para">
        Si la adhesión de transacciones está habilitada y se obtiene un error de tipo
        advertencia al llamar a <span class="function"><a href="function.mysqlnd-ms-fabric-select-shard.html" class="function">mysqlnd_ms_fabric_select_shard()</a></span> o
        <span class="function"><a href="function.mysqlnd-ms-fabric-select-global.html" class="function">mysqlnd_ms_fabric_select_global()</a></span>,
        estblezca la bandera booleana <em>trx_warn_server_list_changes</em>.
       </p>
       <p class="para">
        <div class="example" id="example-2044">
         <p><strong>Ejemplo #13 Advertencias sobre la violación de límites de transacciones</strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;fabric&quot;: {
            &quot;hosts&quot;: [
                {
                    &quot;host&quot; : &quot;127.0.0.1&quot;,
                    &quot;port&quot; : 8080
                }
            ],
            &quot;trx_warn_serverlist_changes&quot;: 1
        },
        &quot;trx_stickiness&quot;: &quot;on&quot;
    }
}</pre>
</div>
         </div>

         <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$enlace&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"myapp"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"root"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"test"</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">/*<br />&nbsp;&nbsp;Para&nbsp;la&nbsp;demostración,&nbsp;la&nbsp;llamada&nbsp;posría&nbsp;fallar.<br />&nbsp;&nbsp;Si&nbsp;falla&nbsp;o&nbsp;no,&nbsp;nos&nbsp;introduciremos&nbsp;en&nbsp;el&nbsp;estado<br />&nbsp;&nbsp;necesario&nbsp;para&nbsp;el&nbsp;ejemplo.<br />*/<br /></span><span style="color: #007700">@</span><span style="color: #0000BB">mysqlnd_ms_fabric_select_global</span><span style="color: #007700">(</span><span style="color: #0000BB">$enlace</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$enlace</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">begin_transaction</span><span style="color: #007700">();<br />@</span><span style="color: #0000BB">$enlace</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"DROP&nbsp;TABLE&nbsp;IF&nbsp;EXISTS&nbsp;test"</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">/*<br />&nbsp;&nbsp;¡Cambiar&nbsp;de&nbsp;servidor/fragmento&nbsp;es&nbsp;un&nbsp;error&nbsp;debido&nbsp;a&nbsp;la<br />&nbsp;&nbsp;transacción&nbsp;local&nbsp;abierta!<br />*/<br /></span><span style="color: #0000BB">mysqlnd_ms_select_global</span><span style="color: #007700">(</span><span style="color: #0000BB">$enlace</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
         </div>

         <div class="example-contents"><p>El resultado del ejemplo sería:</p></div>
         <div class="example-contents screen">
<div class="cdata"><pre>
PHP Warning: mysqlnd_ms_fabric_select_global(): (mysqlnd_ms) Fabric server exchange in the middle of a transaction in %s on line %d
</pre></div>
         </div>
        </div>
       </p>
       <p class="para">
        Por favor, considere la característica como experimental. Podrían cambiarse la sintaxis y la semántica.
       </p>
      </dd>

     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.filters">
       <code class="parameter">filters</code>
       <span class="type"><a href="language.types.object.html" class="type object">object</a></span>
      </dt>

      <dd>

       <p class="para">
        Lista de filtros. Un filtro es el responsable de filtrar la lista de servidores
        disponibles que puedan ejecutar una setentcia dada. Los filtros se pueden encadenar.
        Los filtros <em>random</em> y <em>roundrobin</em>
        reemplazan a la directiva
        <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config.pick" class="link"><em>pick[]</em></a>
        usada en versiones anteriores para seleccionar una política de equilibrado de carga.
        El filtro <em>user</em> reemplaza a la función
        <span class="function"><a href="function.mysqlnd-ms-set-user-pick-server.html" class="function">mysqlnd_ms_set_user_pick_server()</a></span>.
       </p>
       <p class="para">
        Los filtros pueden aceptar parámetros para refinar sus acciones.
       </p>
       <p class="para">
        Si no está establecida una política de equilibrado de carga, el complemento asumirá el valor predeterminado
        <em>random_once</em>. La política <em>random_once</em>
        elige un servidor aleatorio al ejecutar la primera sentencia de solo lectura.
        Este servidor esclavo se usará para todas las sentencias de solo lectura
        hasta que finalice la ejecución del script de PHP. No se establece ninguna política
        de equilibrado de carga y, por lo tanto, toma lugar el valor predeterminado
        si ni <em>random</em> ni
        <em>roundrobin</em> son parte de la sección de configuración.
       </p>
       <p class="para">
        Si una cadena de filtros es configurada de modo que la salida de un filtro que no
        produzca más de un servidor sea usada como entrada para otro filtro al que se le debería proporcionar
        más de un servidor, el complemento podría emitir una advertencia sobre una
        conexión abierta. La advertencia podría ser: <em>(mysqlnd_ms) Error while creating filter &#039;%s&#039; . Non-multi filter &#039;%s&#039; already created.
        Stopping in %s on line %d</em>
        ((mysqlnd_ms) Error al crear el filtro &#039;%s&#039; . No se ha creado aún el filtro múltiple &#039;%s&#039;.
        Detenido en %s en la línea %d). Además, se puede establecer un error
        de código <em>2000</em>, el estado sql <em>HY000</em>,
        y un mensaje de error similar a la advertencia, sobre el gestor de conexión.
       </p>
       <p class="para">
        <div class="example" id="example-2045">
         <p><strong>Ejemplo #14 Secuencia de filtros inválida</strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.78.136&quot;,
                &quot;port&quot;: &quot;3306&quot;
            }
        },
        &quot;filters&quot;: [
            &quot;roundrobin&quot;,
            &quot;random&quot;
        ]
    }
}</pre>
</div>
         </div>

         <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$enlace&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"myapp"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"root"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"test"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"[%d]&nbsp;%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">mysqli_connect_errno</span><span style="color: #007700">(),&nbsp;</span><span style="color: #0000BB">mysqli_connect_error</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">$enlace</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;1&nbsp;FROM&nbsp;DUAL"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
         </div>

         <div class="example-contents"><p>El resultado del ejemplo sería:</p></div>
         <div class="example-contents screen">
<div class="cdata"><pre>
PHP Warning:  mysqli::mysqli(): (HY000/2000): (mysqlnd_ms) Error while creating filter &#039;random&#039; . Non-multi filter &#039;roundrobin&#039; already created. Stopping in filter_warning.php on line 1
[2000] (mysqlnd_ms) Error while creating filter &#039;random&#039; . Non-multi filter &#039;roundrobin&#039; already created. Stopping
PHP Warning:  mysqli::query(): Couldn&#039;t fetch mysqli in filter_warning.php on line 3
</pre></div>
         </div>
        </div>
       </p>
      </dd>

     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.filter-random">
       Filtro: <code class="parameter">random</code>
       <span class="type"><a href="language.types.object.html" class="type object">object</a></span>
      </dt>

      <dd>

       <p class="para">
        El filtro <em>random</em> introduce las políticas de equilibrado de carga
        &quot;aleatoria&quot; y &quot;aleatoria una vez&quot;, establecidas a través de la directiva
        <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config.pick" class="link"><em>pick[]</em></a>
        en versiones anteriores.
       </p>
       <p class="para">
        La política &quot;aleatoria&quot; eligirá un servidor aleatorio siempre que
        se vaya a ejecutar una sentencia de solo lectura. La estrategia &quot;aleatoria una vez&quot;
        elige un servidor esclavo aleatorio una vez y continuará usándolo para el
        resto de la petición web. &quot;Aleatoria una vez&quot; es la predeterminada,
        si el equilibrado de carga no está configurado a través de un filtro.
       </p>
       <p class="para">
        Si al filtro <em>random</em> no se le proporciona ningún argumento,
        permanecerá la política de equilibrado de carga aleatoria.
       </p>
       <p class="para">
        <div class="example" id="example-2046">
         <p><strong>Ejemplo #15 Equilibrado de carga aleatorio con el filtro <em>random</em></strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.78.136&quot;,
                &quot;port&quot;: &quot;3306&quot;
            },
            &quot;slave_1&quot;: {
                &quot;host&quot;: &quot;192.168.78.137&quot;,
                &quot;port&quot;: &quot;3306&quot;
            }
        },
        &quot;filters&quot;: [
            &quot;random&quot;
        ]
    }
}</pre>
</div>
         </div>

        </div>
       </p>
       <p class="para">
        Opcionalmente, se puede pasar el argumento <em>sticky</em> al
        filtro. Si se establece el parámetro <em>sticky</em> al string
        <em>1</em>, el filtro seguirá la estrategia de equilibrado de carga
        &quot;aleatoria una vez&quot;.
       </p>
       <p class="para">
        <div class="example" id="example-2047">
         <p><strong>Ejemplo #16 Equilibrado de carga &quot;aleatoria una vez&quot; con el filtro <em>random</em></strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;filters&quot;: {
        &quot;random&quot;: {
            &quot;sticky&quot;: &quot;1&quot;
        }
    }
}</pre>
</div>
         </div>

        </div>
       </p>
       <p class="para">
        Los filtros <em>random</em> y <em>roundrobin</em>
        admiten el establecimiento de una prioridad, un peso para un servidor, desde
        PECL/mysqlnd_ms 1.4.0. Si se pasa el argumento <em>weight</em> 
        al filtro, debe asginar un peso para todos los servidores. A los servidores se les
        debe proporcionar un sobrenombre en las listas de servidores <em>slave</em> y
        <em>master</em> respectivamente. El alias debe usarse
        para hacer referencia a servidores para asignarles una prioridad con <em>weight</em>.
       </p>
       <p class="para">
        <div class="example" id="example-2048">
         <p><strong>Ejemplo #17 Error de referencia</strong></p>
         <div class="example-contents screen">
<div class="cdata"><pre>
[E_RECOVERABLE_ERROR] mysqli_real_connect(): (mysqlnd_ms) Unknown server &#039;slave3&#039; in &#039;random&#039; filter configuration. Stopping in %s on line %d
</pre></div>
         </div>
        </div>
       </p>
       <p class="para">
        Usar un sobrenombre erróneo con <em>weight</em> podría resultar en
        un error similar al mostrado arriba.
       </p>
       <p class="para">
        Si se omite <em>weight</em>, el peso predeterminado de
        todos los servidores es uno.
       </p>
       <p class="para">
        <div class="example" id="example-2049">
         <p><strong>Ejemplo #18 Asignar <em>weight</em> para el equilibrado de carga</strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
   &quot;myapp&quot;: {
       &quot;master&quot;: {
           &quot;master1&quot;:{
               &quot;host&quot;:&quot;localhost&quot;,
               &quot;socket&quot;:&quot;\/var\/run\/mysql\/mysql.sock&quot;
           }
       },
       &quot;slave&quot;: {
           &quot;slave1&quot;: {
               &quot;host&quot;:&quot;192.168.2.28&quot;,
               &quot;port&quot;:3306
           },
           &quot;slave2&quot;: {
               &quot;host&quot;:&quot;192.168.2.29&quot;,
               &quot;port&quot;:3306
           },
           &quot;slave3&quot;: {
               &quot;host&quot;:&quot;192.0.43.10&quot;,
               &quot;port&quot;:3306
           },
       },
       &quot;filters&quot;: {
           &quot;random&quot;: {
               &quot;weights&quot;: {
                   &quot;slave1&quot;:8,
                   &quot;slave2&quot;:4,
                   &quot;slave3&quot;:1,
                   &quot;master1&quot;:1
               }
           }
       }
   }
}</pre>
</div>
         </div>

        </div>
       </p>
       <p class="para">
        Como promedio, un servidor al que se le asigne un peso de dos será seleccionado el doble
        que un servidor al que se la haya asignado un peso de uno. Se pueden asignar diferentes
        pesos para reflejar diferentes tipos de máquinas, para preferir coubicar esclavos
        que tienen una latencia de red baja o para configurar un servidor de tolerancia a fallos de emergencia.
        En este último caso, se podría asignar al servidor de emergencia un peso muy bajo
        en relación con los demás servidores. Por ejemplo, dada la
        configuración de arriba, <em>slave3</em> obtendrá solamente el ocho
        por ciento de las peticiones como media. Mientras que <em>slave1</em>
        y <em>slave2</em> estén ejecutándose, se usarán con poca frecuencia,
        de forma similar a un servidor de tolerancia a fallos de emergencia. Si ocurre un fallo de <em>slave1</em>
        y de <em>slave2</em>, el uso de <em>slave3</em>
        aumenta. Por favor, revise las notas sobre la tolerancia a fallos antes de usar
        <em>weight</em> de esta manera.
       </p>
       <p class="para">
        El rango de valores válidos del peso es de 1 a 65535.
       </p>
       <p class="para">
        Los argumentos desconocidos son ingnorados. No se dan advertencias ni errores.
       </p>
       <p class="para">
        Espera uno o más servidores como entrada. Produce un servidor.
        Una secuencia de filtros como
        <em>random</em>, <em>roundrobin</em>, puede
        causar una advertencia y establecer un mensaje de error sobre el gestor de
        conexión cuando se ejecute una sentencia.
       </p>
       <p class="para">
        Listado de los argumentos del filtro.
       </p>
       <table class="doctable informaltable">
        
         <col width="1*" />
         <col width="7*" />
         <col width="2*" />
         <thead>
          <tr>
           <th>Palabra clave</th>
           <th>Descripción</th>
           <th>Versión</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td>
            <em>sticky</em>
           </td>
           <td>
            <p class="para">
             Habilita o deshabilita la política de equilibrado de carga
             &quot;aleatoria una vez&quot;. Véase más arriba.
            </p>
           </td>
           <td>Desde 1.2.0.</td>
          </tr>

          <tr>
           <td>
            <em>weight</em>
           </td>
           <td>
            <p class="para">
             Asigna un peso o prioridad de equilibrado de carga a
             un servidor. Por favor, véase la descripción de arriba.
            </p>
           </td>
           <td>Desde 1.4.0.</td>
          </tr>

         </tbody>
        
       </table>

      </dd>

     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.filter-roundrobin">
       Filtro: <code class="parameter">roundrobin</code>
       <span class="type"><a href="language.types.object.html" class="type object">object</a></span>
      </dt>

      <dd>

       <p class="para">
        Si se utiliza el filtro <em>roundrobin</em>, el complemento
        iterará sobre la lista de servidores esclavos configurados para elegir un servidor
        para que ejecute una sentencia. Si el complemento alcanza el final de la lista,
        volverá al inicio de la misma y eligirá el primer
        servidor esclavo configurado.
       </p>
       <p class="para">
        <div class="example" id="example-2050">
         <p><strong>Ejemplo #19 Filtro <em>roundrobin</em></strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.78.136&quot;,
                &quot;port&quot;: &quot;3306&quot;
            }
        },
        &quot;filters&quot;: [
            &quot;roundrobin&quot;
        ]
    }
}</pre>
</div>
         </div>

        </div>
       </p>
       <p class="para">
        Espera uno o más servidores como entrada. Produce un servidor.
        Una secuencia de filtros como
        <em>roundrobin</em>, <em>random</em>, puede
        causar una advertencia y establecer un mensaje de error sobre el gestor de
        conexión cuando se ejecute una sentencia.
       </p>
       <p class="para">
        Listado de los argumentos del filtro.
       </p>
       <table class="doctable informaltable">
        
         <col width="1*" />
         <col width="7*" />
         <col width="2*" />
         <thead>
          <tr>
           <th>Palabra clave</th>
           <th>Descripción</th>
           <th>Versión</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td>
            <em>weight</em>
           </td>
           <td>
            <p class="para">
             Asigna un peso o prioridad de equilibrado de carga a
             un servidor. Por favor, véase la descipción de
             <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config-v2.filter-random" class="link">arriba</a>.
            </p>
           </td>
           <td>Desde 1.4.0.</td>
          </tr>

         </tbody>
        
       </table>

      </dd>

     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.filter-user">
       Filtro: <code class="parameter">user</code>
       <span class="type"><a href="language.types.object.html" class="type object">object</a></span>
      </dt>

      <dd>

       <p class="para">
        El filtro <em>user</em> reemplaza a la función
        <span class="function"><a href="function.mysqlnd-ms-set-user-pick-server.html" class="function">mysqlnd_ms_set_user_pick_server()</a></span>,
        la cual ha sido eliminada en la versión 1.1.0-beta. El filtro establece una llamada de retorno para la
        división de lectura-escritura y la selección del servidor definidas por el usuario.
       </p>
       <p class="para">
        Las decisiones del mecanismo interno de división de consultas de lecura-escritura pueden ser
        sobrescritas de dos maneras. La más sencilla es anteponer a una consulta
        las sugerentecias SQL <strong><code>MYSQLND_MS_MASTER_SWITCH</code></strong>,
        <strong><code>MYSQLND_MS_SLAVE_SWITCH</code></strong> o
        <strong><code>MYSQLND_MS_LAST_USED_SWITCH</code></strong>. Al utilizar sugerencias SQL se puede
        controlar, por ejemplo, si una consulta debería ser enviada al servidor maestro de replicación
        MySQL o a uno de los servidores esclavos. Mediante la ayuda de sugenrencias SQL no es
        posible elegir un esclavo en particular para que ejecute una consulta.
       </p>
       <p class="para">
        Se puede obtener control total en la selección del servidor usando una función de llamada de retorno.
        Solamente se recomienda el uso de una llamada de retorno para usuarios expertos, ya que ésta
        ha de cubrir todos los casos que de otro modo manejaría el complemento.
       </p>
       <p class="para">
        El complemento invorcará a la función de llamada de retorno para seleccionar un servidor de las
        listas de servidores maestros y esclavos configurados. La función de llamada de retorno
        inspeccionará la consulta a ejecutar y eligirá un servidor para que ejecute dicha consulta, devolviendo
        el URI del equipo anfitrión, tal como lo encontró en la lista de maestros y esclavos.
       </p>
       <p class="para">
        Si las conexiones retardadas están habilitadas y la llamada de retorno elige un servidor esclavo para
        el que hasta ahora no se ha establecido una conexión, y el establecimiento de la conexión
        al esclavo falla, el complemento devolverá un error sobre la siguiente acción
        en la conexión fallida, por ejemplo, al ejecutar una consulta. Es
        responsabilidad del desarrollador de la aplicación manejar el error. Por ejemplo,
        la aplicación podría re-ejecutar la consulta para desencadenar una nueva selección de un servidor y una nueva
        invocación a la llamada de retorno. Si lo hace, la llamada de retorno debe asegurarse de seleccionar
        un esclavo diferente, o comprobar la disponibilidad del esclavo, antes de devolver el resultado al
        complemento para evitar un bucle infinito.
       </p>
       <p class="para">
        <div class="example" id="example-2051">
         <p><strong>Ejemplo #20 Establecer una llamada de retorno</strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.78.136&quot;,
                &quot;port&quot;: &quot;3306&quot;
            }
        },
        &quot;filters&quot;: {
            &quot;user&quot;: {
                &quot;callback&quot;: &quot;pick_server&quot;
            }
        }
    }
}</pre>
</div>
         </div>

        </div>
       </p>
       <p class="para">
        Se espera que la llamada devuelva un equipo anfitrión donde ejecutar la consulta.
        El URI del equipo anfitrión se tomará de las listas de conexión maestras y esclavas
        pasadas a la función de llamada de retorno. Si ésta devuelve un valor
        que no se encuentra el las listas de conexión maestras ni en las esclavas, el
        complemento emitirá un error de tipo <em>E_RECOVERABLE_ERROR</em>. El error puede ser
        <em>(mysqlnd_ms) User filter callback has returned an unknown server.
         The server &#039;server that is not in master or slave list&#039; can neither be found in the master list nor in the slave list</em>
        ((mysqlnd_ms) La llamada de retorno del filtro de usuario ha devuelto un servidor desconocido.
        El servidor &#039;servidor que no está en la lista de maestros o esclavos&#039; no se puede encontrar en ni en la lista de maestros ni en la de esclavos).
        Si la aplicación captura el error para ignorarlo, los errores siguientes
        pueden ser establecidos en el gestor de conexión, por ejemplo,
        <em>(mysqlnd_ms) No connection selected by the last filter</em>
        ((mysqlnd_ms) El último filtro no seleccionó ninguna conexión) con el código de error <em>2000</em>
        y el estado sql <em>HY000</em>. Además se puede emitir una advertencia.
       </p>
       <p class="para">
        Si se hace referencia a una función inexistente como llamada de retorno, resultará
        en cualquier error de tipo <em>E_RECOVERABLE_ERROR</em> siempre que
        el complemento intente invocar a dicha función. El mensaje de error puede ser como:
        <em>(mysqlnd_ms) Specified callback (pick_server) is not a valid callback</em>
        ((mysqlnd_ms) La llamada de retorno (pick_server) no es una llamada de retorno válida).
        Si la aplicación captura el error para ignorarlo, los errores siguientes pueden ser
        establecidos en el gestor de conexión, por ejemplo,
        <em>(mysqlnd_ms) Specified callback (pick_server) is
         not a valid callback</em> con el código de error <em>2000</em>
        y el estado sql <em>HY000</em>. Admás se puede emitir una advertencia.
       </p>
       <p class="para">
        Los siguientes parámetros son pasados desde el complemento a la llamada de retorno.
       </p>
       <table class="doctable informaltable">
        
         <col width="1*" />
         <col width="7*" />
         <col width="2*" />
         <thead>
          <tr>
           <th>Parámetro</th>
           <th>Descripción</th>
           <th>Versión</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td>
            <em>connected_host</em>
           </td>
           <td>
            <p class="para">
             El URI del servidor de las bases de datos conectado actualmente.
            </p>
           </td>
           <td>Desde 1.1.0.</td>
          </tr>

          <tr>
           <td>
            <em>query</em>
           </td>
           <td>
            <p class="para">
             La consulta de la sentencia para la cual un servidor necesita
             ser elegido.
            </p>
           </td>
           <td>Desde 1.1.0.</td>
          </tr>

          <tr>
           <td>
            <em>masters</em>
           </td>
           <td>
            <p class="para">
             La lista de servidores maestros de donde elegir. Observe que la lista de servidores
             maestros puede no ser idéntica a la lista de servidores maestros
             configurados si el filtro no es el primero en la cadena de filtros.
             Los filtros ejecutados anteriormente puede haber reducido la lista de
             maestros.
            </p>
           </td>
           <td>Desde 1.1.0.</td>
          </tr>

          <tr>
           <td>
            <em>slaves</em>
           </td>
           <td>
            <p class="para">
             La lista de servidores esclavos de donde elegir. Observe que la lista de servidores
             maestros puede no ser idéntica a la lista de servidores maestros
             configurados si el filtro no es el primero en la cadena de filtros.
             Los filtros ejecutados anteriormente puede haber reducido la lista de
             maestros.
            </p>
           </td>
           <td>Desde 1.1.0.</td>
          </tr>

          <tr>
           <td>
            <em>last_used_connection</em>
           </td>
           <td>
            <p class="para">
             El URI del servidor de la conexión usada donde ejecutar la sentencia
             anterior.
            </p>
           </td>
           <td>Desde 1.1.0.</td>
          </tr>

          <tr>
           <td>
            <em>in_transaction</em>
           </td>
           <td>
            <p class="para">
             Bandera booleana que indica si la sentencia es
             parte de una transacción abierta. Si el modo &#039;autocommit&#039; está desactivado,
             se establecerá a <strong><code>TRUE</code></strong>. Si no,
             se establecerá a <strong><code>FALSE</code></strong>.
            </p>
            <p class="para">
             La detección de transacciones está basada en la monitorización de la
             llamada a <em>set_autocommit</em> de la biblioteca mysqlnd .
             La monitorización no era posible antes de PHP 5.4.0. Por favor, vea la argumentación de los conceptos sobre
             <a href="mysqlnd-ms.pooling.html" class="link">agrupación e intercambio de conexiones</a>
             para más detalles.
            </p>
           </td>
           <td>Desde 1.1.0.</td>
          </tr>

         </tbody>
        
       </table>

       <p class="para">
        <div class="example" id="example-2052">
         <p><strong>Ejemplo #21 Utilizar una llamada de retorno</strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.2.27&quot;,
                &quot;port&quot;: &quot;3306&quot;
            },
            &quot;slave_1&quot;: {
                &quot;host&quot;: &quot;192.168.78.136&quot;,
                &quot;port&quot;: &quot;3306&quot;
            }
        },
        &quot;filters&quot;: {
            &quot;user&quot;: {
                &quot;callback&quot;: &quot;pick_server&quot;
            }
        }
    }
}</pre>
</div>
         </div>

         <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">pick_server</span><span style="color: #007700">(</span><span style="color: #0000BB">$connected</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$masters</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$slaves</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$last_used_connection</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$in_transaction</span><span style="color: #007700">)<br />{<br />&nbsp;static&nbsp;</span><span style="color: #0000BB">$slave_idx&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />&nbsp;static&nbsp;</span><span style="color: #0000BB">$num_slaves&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">;<br />&nbsp;if&nbsp;(</span><span style="color: #0000BB">is_null</span><span style="color: #007700">(</span><span style="color: #0000BB">$num_slaves</span><span style="color: #007700">))<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$num_slaves&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$slaves</span><span style="color: #007700">);<br /><br />&nbsp;</span><span style="color: #FF8000">/*&nbsp;predeterminado:&nbsp;volver&nbsp;a&nbsp;la&nbsp;lógica&nbsp;interna&nbsp;del&nbsp;comlemento&nbsp;*/<br />&nbsp;</span><span style="color: #0000BB">$ret&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">;<br /><br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"El&nbsp;usuario&nbsp;se&nbsp;ha&nbsp;conectado&nbsp;a&nbsp;'%s'...\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$connected</span><span style="color: #007700">);<br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"...&nbsp;decidiendo&nbsp;dónde&nbsp;ejecutar&nbsp;'%s'\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br /><br />&nbsp;</span><span style="color: #0000BB">$where&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysqlnd_ms_query_is_select</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br />&nbsp;switch&nbsp;(</span><span style="color: #0000BB">$where</span><span style="color: #007700">)<br />&nbsp;{<br />&nbsp;&nbsp;case&nbsp;</span><span style="color: #0000BB">MYSQLND_MS_QUERY_USE_MASTER</span><span style="color: #007700">:<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"...&nbsp;usando&nbsp;el&nbsp;maestro\n"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ret&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$masters</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;case&nbsp;</span><span style="color: #0000BB">MYSQLND_MS_QUERY_USE_SLAVE</span><span style="color: #007700">:<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;SELECT&nbsp;or&nbsp;SQL&nbsp;hint&nbsp;for&nbsp;using&nbsp;slave&nbsp;*/<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">stristr</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"FROM&nbsp;table_on_slave_a_only"</span><span style="color: #007700">))<br />&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;una&nbsp;tabla&nbsp;que&nbsp;está&nbsp;únicamente&nbsp;en&nbsp;el&nbsp;primer&nbsp;esclavo&nbsp;configurado&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"...&nbsp;detectado&nbsp;un&nbsp;acceso&nbsp;a&nbsp;la&nbsp;tabla&nbsp;únicamente&nbsp;disponible&nbsp;en&nbsp;el&nbsp;esclavo&nbsp;A\n"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ret&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$slaves</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;else<br />&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;rotativo&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"...&nbsp;alguna&nbsp;consulta&nbsp;de&nbsp;solo&nbsp;lectura&nbsp;para&nbsp;un&nbsp;esclavo\n"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ret&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$slaves</span><span style="color: #007700">[</span><span style="color: #0000BB">$slave_idx</span><span style="color: #007700">++&nbsp;%&nbsp;</span><span style="color: #0000BB">$num_slaves</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;case&nbsp;</span><span style="color: #0000BB">MYSQLND_MS_QUERY_LAST_USED</span><span style="color: #007700">:<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"...&nbsp;usando&nbsp;el&nbsp;último&nbsp;esclavo&nbsp;utilizado\n"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ret&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$last_used_connection</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;break;<br />&nbsp;}<br /><br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"...&nbsp;ret&nbsp;=&nbsp;'%s'\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ret</span><span style="color: #007700">);<br />&nbsp;return&nbsp;</span><span style="color: #0000BB">$ret</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"myapp"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"root"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"test"</span><span style="color: #007700">);<br /><br />if&nbsp;(!(</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;1&nbsp;FROM&nbsp;DUAL"</span><span style="color: #007700">)))<br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"[%d]&nbsp;%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">errno</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error</span><span style="color: #007700">);<br />else<br />&nbsp;</span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br /><br />if&nbsp;(!(</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;2&nbsp;FROM&nbsp;DUAL"</span><span style="color: #007700">)))<br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"[%d]&nbsp;%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">errno</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error</span><span style="color: #007700">);<br />else<br />&nbsp;</span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br /><br /><br />if&nbsp;(!(</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;table_on_slave_a_only"</span><span style="color: #007700">)))<br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"[%d]&nbsp;%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">errno</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error</span><span style="color: #007700">);<br />else<br />&nbsp;</span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
         </div>

         <div class="example-contents"><p>El resultado del ejemplo sería:</p></div>
         <div class="example-contents screen">
<div class="cdata"><pre>
El usuario se ha conectado a &#039;myapp&#039;...
... decidiendo dónde ejecutar &#039;SELECT 1 FROM DUAL&#039;
... alguna consulta de solo lectura para un esclavo
... ret = &#039;tcp://192.168.2.27:3306&#039;
El usuario se ha conectado a &#039;myapp&#039;...
... decidiendo dónde ejecutar &#039;SELECT 2 FROM DUAL&#039;
... alguna consulta de solo lectura para un esclavo
... ret = &#039;tcp://192.168.78.136:3306&#039;
El usuario se ha conectado a &#039;myapp&#039;...
... decidiendo dónde ejecutar &#039;SELECT * FROM table_on_slave_a_only&#039;
... detectado un acceso a la tabla únicamente disponible en el esclavo A
... ret = &#039;tcp://192.168.2.27:3306&#039;
</pre></div>
         </div>
        </div>
       </p>
      </dd>

     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.filter-user-multi">
       Filtro: <code class="parameter">user_multi</code>
       <span class="type"><a href="language.types.object.html" class="type object">object</a></span>
      </dt>

      <dd>

       <p class="para">
        El filtro <em>user_multi</em> se diferencia de <em>user</em>
        en un único aspecto. De otro modo su sintaxix sería idéntica.
        El filtro <em>user</em> debe elegir
        y devolver exactamente un nodo para la ejecución de sentecias. Una cadena de filtros
        normalmente finaliza con un filtro que emite un único nodo. La cadena de filtros
        reduciría la lista de candidatos para la ejecución de sentencias a
        uno. Este es el caso, sólo queda un nodo, después de haber ejecutado
        el filtro <em>user</em>.
       </p>
       <p class="para">
        El filtro <em>user_multi</em> es un filtro múltiple. Devuelve una
        lista de servidors esclavos y una lista de servidores maestros. La lista necesita más filtración
        para identificar exactamente un nodo para la ejecución de sentencias. Un filtro múltiple normalmente se
        coloca al principio de la cadenda de filtros. El filtro <em>quality_of_service</em>
        es otro ejemplo de filtro múltiple.
       </p>
       <p class="para">
        El valor devuelto por la llamada de retorno establecido por <em>user_multi</em> debe
        ser un array con dos elementos. El primero contiene una lista de los servidores maestros
        seleccionados. El segundo contiene una lista de los servidores esclavos seleccionados.
        Las listas contendrán las claves de los servidores maestros y esclavos tal como se encontraron en
        las listas de esclavos y maestros pasadas a la llamada de retorno. El ejemplo de abajo devuelve
        listas de maestros y esclavos aleatorios extraídas de la entrada de la función.
       </p>
       <p class="para">
        <div class="example" id="example-2053">
         <p><strong>Ejemplo #22 Devolver maestros y esclavos aleatorios</strong></p>
         <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">pick_server</span><span style="color: #007700">(</span><span style="color: #0000BB">$connected</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$masters</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$slaves</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$last_used_connection</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$in_transaction</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$maestros_elegidos&nbsp;</span><span style="color: #007700">=&nbsp;array()<br />&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$masters&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$clave&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$valor</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">mt_rand</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">)&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$maestros_elegidos</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">;<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$esclavos_elegidos&nbsp;</span><span style="color: #007700">=&nbsp;array()<br />&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$slaves&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$clave&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$valor</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">mt_rand</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">)&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$esclavos_elegidos</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$clave</span><span style="color: #007700">;<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;return&nbsp;array(</span><span style="color: #0000BB">$maestros_elegidos</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$esclavos_elegidos</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
         </div>

        </div>
       </p>
       <p class="para">
        El complemento emitirá un error de tipo <em>E_RECOVERABLE</em> si la llamada de retorno falla al devolver
        la lista de servidores. El error puede ser <em>(mysqlnd_ms) User multi filter
        callback has not returned a list of servers to use. The callback must return an array in %s on line %d</em>
        ((mysqlnd_ms) La llamada de retorno del filtro de usuario no ha devuelto una lista de servidores a usar.
        La llamada de retorno debe devolver un array en %s en la línea %d).
        En caso de que la lista de servidores no esté vacía pero contenga claves/ids de servidores no válidos,
        e lanzaráun error de tipo <em>E_RECOVERABLE</em> con un mensaje de error como
        <em>(mysqlnd_ms) User multi filter callback has returned an invalid list of servers to use.
         Server id is negative in %s on line %d</em>
        ((mysqlnd_ms) La llamada de retorno del filtro de usuario ha devuelto una lista de servidores a usar no válida. El id del servidor es negativo en %s en la línea %d), o similar.
       </p>
       <p class="para">
        La emisión de un error en caso de que la lista de esclavos o de maestros esté vacía
        depende de la configuración. Si se devuelve una lista de maestros vacía
        para una operación de escritura, es probable que el complemento emita una advertencia como
        <em>(mysqlnd_ms) Couldn&#039;t find the appropriate master connection. 0 masters to choose from. Something is wrong in %s on line %d</em>
        ((mysqlnd_ms) No se pudo encontrar la conexión maestra apropiada. 0 maestros donde elegir. Algo está mal en %s en la línea %d).
        Normalmente también es seguida de un error de tipo <em>E_ERROR</em>.
        En el caso de una operación de lectura con una lista de servidores vacía, el comportamiento depende de la configuración
        de la tolerancia a fallos. Si ésta está habilitada en el maestro, no debería aparecer ningún error. Si está desactivada
        en el maestro, el complemento emitirá una advertencia como <em>(mysqlnd_ms) Couldn&#039;t find the appropriate
        slave connection. 0 slaves to choose from. Something is wrong in %s on line %d</em>
        ((mysqlnd_ms) No se pudo encontrar la conexión esclava apropiada. 0 esclavos donde elegir. Algo está mal en %s en la línea %d).
       </p>
      </dd>

     
     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.filter-node-groups">
       Filtro: <code class="parameter">node_groups</code>
       <span class="type"><a href="language.types.object.html" class="type object">object</a></span>
      </dt>

      <dd>

       <p class="para">
        El filtro <em>node_groups</em> permite agrupas nodos de clúster
        y consultar grupos seleccionados, por ejemplo, para dar soporte al particionamiento de datos.
        El particionamiento de datos puede ser neceario para la fragmentación manual, copia primaria basada
        el clústeres ejecutándose en múltiples maestros, o para evitar puntos calientes en actualizaciones de cualquier
        clúster que no posea particionamiento interno. El filtro es un filtro múltiple
        que devuelve cero, uno o múltiples servidores de su entrada. Así, le deben
        seguir otros filtros para reducir el número de candidatos
        a uno por ejecución de sentencia.
       </p>
       <table class="doctable informaltable">
        
         <col width="1*" />
         <col width="7*" />
         <col width="2*" />
         <thead>
          <tr>
           <th>Palabra clave</th>
           <th>Descripción</th>
           <th>Versión</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td>
            <em>nombre del grupo de nodos definido por el usuario</em>
           </td>
           <td>
            <p class="para">
             Se debe definir uno o más grupos de nodos. Un grupos de nodos puede tener un
             nombre arbitrario definido por el usuario. El nombre se usa junto con
             una sugerencia SQL para restringir la ejecución de consultas a los nodos enumerados para el
             grupo de nodos. Para ejecutar una consulta en cualquier servidor de un grupo de nodos,
             esta debe comenzar con la sugerencia SQL
             <em>/*user defined node group name*/</em>.
             Observe que no están permitidos espacios en blanco en
             <em>user defined node group name</em>. Ya que
             <em>user defined node group name</em> se usa tal cual
             como parte de una sugerencia SQL, debería elegirse el nombre que siga
             las normas del lenguaje SQL.
            </p>
            <p class="para">
             Cada entrada del grupo de nodos debe contener una lista de servidores
             <em>master</em>. Están permitidos servidores <em>slave</em> adicionales.
             El no proporcionar una lista de <em>master</em> a un grupos de nodos
             <em>name_of_group</em> podría causar un
             error de tipo <strong><code>E_RECOVERABLE_ERROR</code></strong> como
             <em>(mysqlnd_ms) No masters configured in node group &#039;name_of_group&#039; for &#039;node_groups&#039; filter</em>.
            </p>
            <p class="para">
             La lista de servidores maestros y esclavos debe hacer referencia a las entradas
             correspondientes en la lista de servidores
             <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config-v2.master" class="link">global de maestros</a>
             y <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config-v2.slave" class="link">esclavos</a> respectivamente.
             Hacer referencia a un servidor desconocido en ambas listas de
             servidores podría causar un error <strong><code>E_RECOVERABLE_ERROR</code></strong> como
             <em>(mysqlnd_ms) Unknown master &#039;server_alias_name&#039; (section &#039;name_of_group&#039;) in &#039;node_groups&#039; filter configuration</em>.
            </p>
            <p class="para">
             <div class="example" id="example-2054">
              <p><strong>Ejemplo #23 Particionamiento manual</strong></p>
              <div class="example-contents">
<div class="inicode"><pre class="inicode">{
  &quot;myapp&quot;: {
       &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;,
                &quot;socket&quot;: &quot;\/tmp\/mysql.sock&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.2.28&quot;,
                &quot;port&quot;: 3306
            },
            &quot;slave_1&quot;: {
                &quot;host&quot;: &quot;127.0.0.1&quot;,
                &quot;port&quot;: 3311
            }
        },
        &quot;filters&quot;: {
            &quot;node_groups&quot;: {
                &quot;Partition_A&quot; : {
                    &quot;master&quot;: [&quot;master_0&quot;],
                    &quot;slave&quot;: [&quot;slave_0&quot;]
                }
            },
           &quot;roundrobin&quot;: []
        }
    }
}</pre>
</div>
              </div>

             </div>
            </p>
            <p class="para">
             Observe que si una cadena de filtros
             genera una lista de esclavos vacía y la directiva de configuración de PHP
             <em>mysqlnd_ms.multi_master=0</em> se usa, el complemento podría
             emitiri una advertencia.
            </p>
           </td>
           <td>Desde 1.5.0.</td>
          </tr>

         </tbody>
        
       </table>

      </dd>

     
     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.filter-qos">
       Filtro: <code class="parameter">quality_of_service</code>
       <span class="type"><a href="language.types.object.html" class="type object">object</a></span>
      </dt>

      <dd>

       <p class="para">
        El filtro <em>quality_of_service</em> identifica nodos del clúster
        capaces de proporcionar una calidad de servicio en particular. Es un filtro múltiple
        que devuelve cero, uno o múltiples de los servidores que se le proporcionen. Por lo tanto,
        deben seguirle otros filtros para reducir el número de candidatos
        a uno para la ejecución de sentecnias.
       </p>
       <p class="para">
        El filtro <em>quality_of_service</em> ha sido introducido en la versión 1.2.0-alpha.
        En las serires 1.2, el filtro se centra en el aspecto de la consistencia de
        la calidad del servicio. Diferentes tipos de clústeres ofrecen diferentes
        consistencias de datos predeterminadas. Por ejemplo, un esclavo de replicación MySQL
        asíncrono ofrece consistencia final. El esclavo podría
        no proporcionar los datos solicitados debido a que no ha replicado la escritura,
        podría servir una base de datos antigua debido a su demora, o podría servir
        información actual. A menudo, esto es aceptable. En algunos casos
        son necesarios niveles de consistencia mayor para que la aplicación funcione correctamente.
        En tales casos, <em>quality_of_service</em> puede ignorar los nodos del clúster
        que no proporcionen la calidad de servicio necesaria.
       </p>
       <p class="para">
        El filtro <em>quality_of_service</em> puede ser reemplazado o creado
        en tiempo de ejecución. Una llamada exitosa a
        <span class="function"><a href="function.mysqlnd-ms-set-qos.html" class="function">mysqlnd_ms_set_qos()</a></span>
        elimina todas las entradas de los filtros <em>qos</em> existentes de la
        lista de filtros e instala uno nuevo al principo de la misma. Todas los ajustes
        que se pueden hacer a través de
        <span class="function"><a href="function.mysqlnd-ms-set-qos.html" class="function">mysqlnd_ms_set_qos()</a></span>
        también pueden realizarse en el fichero de configuración del complemento. Sin embargo, el uso de la función
        es de lejos el caso más común. En lugar de establecer los niveles de servicios de
        consistencia de sesión y de consistencia fuerte en el fichero de configuración del complemento, se
        recomienda definir solamente maestros, y no esclavos. Ambos niveles de servicio
        forzarán el uso de maestros solamente. Usar una lista de esclavos vacía abrevia el
        fichero de configuración, y así se mejora su legibilidad. El único nivel de servicio en el que
        existe un caso para la definición en el fichero de configuración del complemento es la combinación de
        consistencia final y demora máxima de esclavos.
       </p>
       <table class="doctable informaltable">
        
         <col width="1*" />
         <col width="7*" />
         <col width="2*" />
         <thead>
          <tr>
           <th>Palabra clave</th>
           <th>Descripción</th>
           <th>Versión</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td>
            <em>eventual_consistency</em>
           </td>
           <td>
            <p class="para">
             Solicita la consistencia final. Permite el uso de todos los
             servidores maestros y esclavos. Los datos devueltos pueden o no ser actuales.
            </p>
            <p class="para">
             La consistencia final acepta el parámetro opcional <em>age</em>.
             Si se proporciona <em>age</em>, el complemento considerará
             para la lectura solamente los esclavos que la replicación MySQL notifique
             que tengan una demora menor o igual a <em>age</em>.
             La demora de replicación se mide usando <em>SHOW SLAVE STATUS</em>.
             Si el complemento falla al recuperar la demora de replicación, saltará el esclavo
             comprobado. Los detalles de implementación y algunos consejos se proporcionan en la
             <a href="mysqlnd-ms.qos-consistency.html" class="link">sección de conceptos de calidad de servicio</a>.
            </p>
            <p class="para">
             Por favor, observe que si una cadena de filtros
             genera un lista vacía de esclavos y se usa la directiva de configuración de PHP
             <em>mysqlnd_ms.multi_master=0</em>, el complemento podría
             emitir una advertencia.
            </p>
            <p class="para">
             <div class="example" id="example-2055">
              <p><strong>Ejemplo #24 Límite global de la demora de los esclavos</strong></p>
              <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.2.27&quot;,
                &quot;port&quot;: &quot;3306&quot;
            },
            &quot;slave_1&quot;: {
                &quot;host&quot;: &quot;192.168.78.136&quot;,
                &quot;port&quot;: &quot;3306&quot;
            }
        },
        &quot;filters&quot;: {
            &quot;quality_of_service&quot;: {
                &quot;eventual_consistency&quot;: {
                    &quot;age&quot;:123
                }
            }
        }
    }
}</pre>
</div>
              </div>

             </div>
            </p>
           </td>
           <td>Desde 1.2.0.</td>
          </tr>

          <tr>
           <td>
            <em>session_consistency</em>
           </td>
           <td>
            <p class="para">
             Solicita la consistencia de sesión (lectura de sus escrituras). Permite el uso de todos los maestros
             y todos los esclavos que están sincronizados con el maestro.
             Si no se proporcionan más parámetros, los esclavos son filtrados
             debido a que no existe una manera fiable de comprobar si un esclavo se a puesto al día con
             respecto al maestro o si está retrasado. Por favor, observe que si una cadena de filtros
             genera una lista de esclavos vacía y se usa la directiva de configuración de PHP
             <em>mysqlnd_ms.multi_master=0</em>, el complemento podría
             emitir una advertencia.
            </p>
            <p class="para">
             La solicitud temporal de la consistencia de sesión usando
             <span class="function"><a href="function.mysqlnd-ms-set-qos.html" class="function">mysqlnd_ms_set_qos()</a></span> es una alternativa
             a usar <em>master_on_write</em>.
             <em>master_on_write</em> probablemente envía más sentencias
             al maestro de las necesarias. La aplicación puede continuar
             la operación en un nivel de consistencia más bajo después de haber realizado
             algunas lecturas críticas.
            </p>
           </td>
           <td>Desde 1.1.0.</td>
          </tr>

          <tr>
           <td>
            <em>strong_consistency</em>
           </td>
           <td>
            <p class="para">
             Solitica la consistencia fuerte. Solamente serán usados los maestros.
            </p>
           </td>
           <td>Desde 1.2.0.</td>
          </tr>

         </tbody>
        
       </table>

      </dd>

     
     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.failover">
       <code class="parameter">failover</code>
       Hasta, e incluyendo 1.3.x: <span class="type"><a href="language.types.string.html" class="type string">string</a></span>.
       Desde 1.4.0: <span class="type"><a href="language.types.object.html" class="type object">object</a></span>.
      </dt>

      <dd>

       <p class="para">
        Política de la tolerancia a fallos. Políticas admitidas:
        <em>disabled</em> (predeterminada), <em>master</em>,
        <em>loop_before_master</em> (desde 1.4.0).
       </p>
       <p class="para">
        Si no se establece ninguna política de tolerancia a fallos, el complemento no realizará ninguna
        tolerancia a fallos automática (<em>failover=disabled</em>). Siempre que
        el complemento falle al conectarse a un servidor, emitirá una advertencia y
        establecerá el código y el mensaje del error de conexión. A partir de entonces, es responsabilidad
        de la aplicación manejar el error y, por ejemplo, reenviar la
        última sentencia para provocar la selección de otro servidor.
       </p>
       <p class="para">
        Observe que la lógica de tolerancia a fallos automática se aplica al abrir
        conexiones solamente. Una vez que una conexión ha sido abierta, no se realizan intentos
        automáticos para reabrirla en caso de error. Si, por ejemplo, si la conexión
        a un servidor se cierra y el usuario intenta
        ejecutar una sentencia sobre dicha conexión, no se intentará la tolerancia a fallos
        automática. En su lugar se notificará un error.
       </p>
       <p class="para">
        Si se usa <em>failover=master</em>, el complemento implícitamente
        usará la tolerancia a fallos del maestro. Por favor, revise la
        documentación de conceptos para informarse sobre los problemas y
        riesgos potenciales del uso de <em>failover=master</em>.
       </p>
       <p class="para">
        <div class="example" id="example-2056">
         <p><strong>Ejemplo #25 Tolerancia a fallos opcional en el maestro al fallar una conexión a un esclavo</strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.78.136&quot;,
                &quot;port&quot;: &quot;3306&quot;
            }
        },
        &quot;failover&quot;: &quot;master&quot;
    }
}</pre>
</div>
         </div>

        </div>
       </p>
       <p class="para">
        Desde PECL/mysqlnd_ms 1.4.0 la palabra clave de la configuración de la tolerancia a fallos
        se refiere a un objeto.
       </p>
       <p class="para">
        <div class="example" id="example-2057">
         <p><strong>Ejemplo #26 Nueva sintaxis desde 1.4.0</strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.78.136&quot;,
                &quot;port&quot;: &quot;3306&quot;
            }
        },
        &quot;failover&quot;: {&quot;strategy&quot;: &quot;master&quot; }
    }
}</pre>
</div>
         </div>

        </div>
       </p>
       <table class="doctable informaltable">
        
         <col width="1*" />
         <col width="7*" />
         <col width="2*" />
         <thead>
          <tr>
           <th>Palabra clave</th>
           <th>Descripción</th>
           <th>Versión</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td>
            <em>strategy</em>
           </td>
           <td>
            <p class="para">
             Política de tolerancia a fallos. Valores posibles:
             <em>disabled</em> (predeterminado), <em>master</em>,
             <em>loop_before_master</em>
            </p>
            <p class="para">
             El valor <em>disabled</em> deshabilita la tolerancia a fallos automática.
            </p>
            <p class="para">
             Establecer <em>master</em> ordena al complemento a intentar
             conectarse a un maestro en caso de un error de conexión esclava. Si el
             intento de conexión maestra falla, el comlemento se saldrá del bucle de tolerancia a
             fallos y devolverá un error al usuario.
            </p>
            <p class="para">
             Si se usa <em>loop_before_master</em> y se realiza una petición a
             un esclavo, el complemento intentará conectarse a otro esclavo antes realizar la tolerancia
             a fallos en un maestro. Si se dan múltiples maestros y está habilitado el multimaestro,
             el complemento también iterará sobre la lista de maestros e intentará conectarse
             antes de devolver un error al usuario.
            </p>
           </td>
           <td>Desde 1.4.0.</td>
          </tr>

          <tr>
           <td>
            <em>remember_failed</em>
           </td>
           <td>
            <p class="para">
             Recuerda los fallos durante una petición web. Predeterminado:
             <em>false</em>.
            </p>
            <p class="para">
             Si se establece a <em>true</em> el complemento recordará los equipos
             anfitriones fallidos y los saltará en todos los equilibrados de carga futuros realizados
             para la duración de la petición web actual.
            </p>
           </td>
           <td>
            Desde 1.4.0. La característica solamente está disponible junto con
            con los filtros de equilibrado de carga <em>random</em> y
            <em>roundrobin</em>. Se recomienda el uso del ajuste.
           </td>
          </tr>

          <tr>
           <td>
            <em>max_retries</em>
           </td>
           <td>
            <p class="para">
             Número máximo de intentos de conexión antes de saltarse un equipo anfitrión.
             Predeterminado: <em>0</em> (sin límite).
            </p>
            <p class="para">
             Este ajuste se usa para prevenir que los equipos anfitriones sean elegidos de la
             lista host si ocurre un primer fallo. Si se establece a <em>n &gt; 0</em>,
             el complemento guardará el nodo en la lista de nodos incluso después de un intento
             de conexión fallido. El nodo no será eliminado inmediatamente de las lista de esclavos y
             maestros respectivamente después del primer fallo de conexión, pero en su lugar se intentará
             conectar hasta <em>n</em> veces en las rondas de equilibrado de carga futuras
             antes de ser eliminado.
            </p>
           </td>
           <td>
            Desde 1.4.0. La característica solamente está disponible junto con
            con los filtros de equilibrado de carga <em>random</em> y
            <em>roundrobin</em>.
           </td>
          </tr>

         </tbody>
        
       </table>

       <p class="para">
        Establecer <em>failover</em> a cualquier valor distinto de
        <em>disabled</em>, <em>master</em> o
        <em>loop_before_master</em>
        no emitirá ninguna advertencia o error.
       </p>
      </dd>

     
     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.lazy-connections">
       <code class="parameter">lazy_connections</code>
       <span class="type"><a href="language.types.boolean.html" class="type bool">bool</a></span>
      </dt>

      <dd>

       <p class="para">
        Controla el uso de conexiones retardadas. Las conexiones retardadas
        son conexiones que no se abren antes de que un cliente envíe la primera
        conexión. Las conexiones retardadas son las predeterminadas.
       </p>
       <p class="para">
        Se recomeinda encarecidamente usar conexiones retardadas.
        Éstas ayudan a mantener bajo el número de conexiones abiertas.
        Si se desabilitan las conexiones retardas y, por ejemplo, se configura un servidor
        maestro de replicación MySQL y dos esclavos de replicación MySQL, el
        complemento abrirá tres conexiones en la primera llamada a la
        función de conexión, aunque la aplicación podría usar solamente la conexión
        maestra.
       </p>
       <p class="para">
        Las conexiones retardadas revelan un riesgo si se realizan un gran uso de acciones
        que cambian el estado de una conexión. El complemento no resolverá
        todas las acciones de cambio de estado de todas las conexiones de la agrupación de conexiones.
        Las pocas acciones resueltas son aplicadas solamente a conexiones ya
        abiertas. Las conexiones retardadas abiertas en el futuro no son afectadas.
        Solamente algunos ajustes son &quot;recordados&quot; y aplicados cuando las
        conexiones retardadas son abiertas.
       </p>
       <p class="para">
        <div class="example" id="example-2058">
         <p><strong>Ejemplo #27 Deshabilitar las conexiones retardadas</strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.78.136&quot;,
                &quot;port&quot;: &quot;3306&quot;
            }
        },
        &quot;lazy_connections&quot;: 0
    }
}</pre>
</div>
         </div>

        </div>
       </p>
       <p class="para">
        Por favor, véase también <em>server_charset</em> para superar problemas
        potenciales con el escapado de cadenas de texto y con servidores que utilicen conjuntos de
        caracteres diferentes del predeterminado.
       </p>
      </dd>

     
     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.server-charset">
       <code class="parameter">server_charset</code>
       <span class="type"><a href="language.types.string.html" class="type string">string</a></span>
      </dt>

      <dd>

       <p class="para">
        Este ajuste ha sido introducido en la versión 1.4.0. Se recomienda establecerlo
        si se van a usar conexiones retardadas.
       </p>
       <p class="para">
        El ajuste <em>server_charset</em> sirve para dos propósitos.
        Actúa como conjunto de caracteres alternativo para su uso con el escapado de cadenas de texo
        realizado antes de que se haya establecido una conexión, y ayuda a evitar problemas de escapado
        en entornos heterogéneos con servidores que utilizan diferentes conjuntos de caracteres predeterminados.
       </p>
       <p class="para">
        El escapado de cadenas de texto toma en cuenta el conjunto de caracteres de una conexión. El escapado de cadenas de texto
        no es posible antes de que una conexión haya sido abierta y se conozca el conjunto de caracteres de
        de la conexión. El uso de conexiones retardadas demora la apertura real
        de conexiones hasta que se envíe una sentencia.
       </p>
       <p class="para">
        Una aplicación que utilice conexiones retardadas puede intentar escapar una cadena de texto antes de
        nviar una setencia. De hecho, esto debería ser un caso común, ya que la sentencia podría contener la
        cadena de texto que va a ser escapada. Sin embargo, debido a la característica de conexiones retardadas,
        aún no se ha abierto ninguna conexión y el escapado falla. El complemento podría notificar un error de tipo
        <em>E_WARNING</em> y un mensaje como <em>(mysqlnd_ms)
        string escaping doesn&#039;t work without established connection.
        Possible solution is to add server_charset to your configuration</em>
        ((mysqlnd_ms) el escapado de cadenas de texto no funciona sin establecer una conexión.
        Una posible solución es añadir server_charset a la configuración) para informar del problema.
       </p>
       <p class="para">
        Establecer <em>server_charset</em> hace que el complemento use
        el conjunto de caracteres dado para el escapado de cadenas de texto realizado sobre gestores de conexines retardadas
        antes de establecer una conexión de red a MySQL. Además, el
        complemento forzará el uso del conjunto de caracteres cuando la conexión
        sea establecida.
       </p>
       <p class="para">
        El forzado del uso del conjunto de caracteres utilizado para el escapado se realiza
        para prevenir los problemas de usar un conjunto de caracteres diferente para el escapado
        que el usado después para la conexión. Esto tiene el benificio adicional
        de eliminar la necesidad de ajustar la configuración del conjunto de caracteres de todos
        los servidores usados. No importa cuál sea el conjunto de caracteres predeterminado de cualquier servidor,
        el complemento establecerá el configurado como el predeterminado.
       </p>
       <p class="para">
        El complemento no impide al usuario cambiar el conjunto de caracteres en cualquier momento
        mediante la llamada a <span class="function"><strong>set_charset()</strong></span> o las setencias SQL correspondientes.
        Por favor, observe que el uso de SQL no se recomienda ya que no puede ser monitorizado
        por el complemento. El usuario puede, por ejemplo, cambiar el conjunto de caracteres sobre un
        gestor de conexiones retaradadas después de escapar una cadena de texto y antes de abrir la conexión
        real. El conjunto de caracteres establecido por el usuario será usado para cualquier escapado subsiguiente
        antes de que se establezca la conexión. Ésta será establecida usando
        el conjunto de caracteres configurado, sin importar cuál es el conjunto de caracteres del servidor ni
        cuál ha establecido el usuario antes. Una vez que una conexión ha sido abierta,
        <em>set_charset</em> ya no tiene sentido.
       </p>
       <p class="para">
        <div class="example" id="example-2059">
         <p><strong>Ejemplo #28 Escapado de cadenas de texto sobre un gestor de conexiones retardadas</strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.78.136&quot;,
                &quot;port&quot;: &quot;3306&quot;
            }
        },
        &quot;lazy_connections&quot;: 1,
        &quot;server_charset&quot; : &quot;utf8&quot;
    }
}</pre>
</div>
         </div>

         <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"myapp"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"nombre_usuario"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"contraseña"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"base_datos"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">real_escape</span><span style="color: #007700">(</span><span style="color: #DD0000">"esto&nbsp;será&nbsp;escapado&nbsp;usando&nbsp;el&nbsp;ajuste&nbsp;server_charset&nbsp;-&nbsp;utf8"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">set_charset</span><span style="color: #007700">(</span><span style="color: #DD0000">"latin1"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">real_escape</span><span style="color: #007700">(</span><span style="color: #DD0000">"esto&nbsp;será&nbsp;escapado&nbsp;usando&nbsp;latin1"</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">/*&nbsp;conjunto&nbsp;de&nbsp;caracteres&nbsp;del&nbsp;servidor&nbsp;implícitamente&nbsp;establecido&nbsp;-&nbsp;conexión&nbsp;utf8&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;'Esta&nbsp;conexión&nbsp;será&nbsp;fijada&nbsp;a&nbsp;server_charset&nbsp;durante&nbsp;su&nbsp;establecimiento'&nbsp;AS&nbsp;_msg&nbsp;FROM&nbsp;DUAL"</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">/*&nbsp;latin1&nbsp;se&nbsp;usará&nbsp;de&nbsp;aquí&nbsp;en&nbsp;adelante&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">set_charset</span><span style="color: #007700">(</span><span style="color: #DD0000">"latin1"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
         </div>

        </div>
       </p>
      </dd>

     
     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.master-on-write">
       <code class="parameter">master_on_write</code>
       <span class="type"><a href="language.types.boolean.html" class="type bool">bool</a></span>
      </dt>

      <dd>

       <p class="para">
        Si se establece, el complemento usará únicamente el servidor maestro después de que
        se haya ejecutado la primera sentencia en el maestro. Las aplicaciones
        aún pueden enviar sentencias a los esclavos usando sugerencias SQL para
        invalidar la decisión automática.
       </p>
       <p class="para">
        Este ajuste puede ser útil con la demora de replicación. Si una aplicación ejecuta
        un <em>INSERT</em>, el complemento usará, de manera predeterminada, el
        maestro para ejecutar todas las sentencias siguientes, incluidas las
        sentencias <em>SELECT</em>. Esto ayuda a evitar problemas con
        las lecturas desde los esclavos que no hayan replicado aún el
        <em>INSERT</em>.
       </p>
       <p class="para">
        <div class="example" id="example-2060">
         <p><strong>Ejemplo #29 master_on_write para lecturas consistentes</strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.78.136&quot;,
                &quot;port&quot;: &quot;3306&quot;
            }
        },
        &quot;master_on_write&quot;: 1
    }
}</pre>
</div>
         </div>

        </div>
       </p>
       <p class="para">
        Por favor, observe que el filtro <em>quality_of_service</em> fue introducido
        en la versión 1.2.0-alpha. Proporciona mayor control sobre, por ejemplo, la realización de
        la lectura se sus escrituras y ofrece funcionalidad adicional introduciendo los
        <a href="mysqlnd-ms.qos-consistency.html" class="link">niveles de servicio</a>.
       </p>
       <p class="para">
        Todos los ajustes de <a href="mysqlnd-ms.plugin-ini-json.html#ini.mysqlnd-ms-plugin-config-v2.trx-stickiness" class="link">adhesión de transacciones</a>,
        incluyendo <em>trx_stickiness=on</em>, son invalidados por <em>master_on_write=1</em>.
       </p>
      </dd>

     
     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.trx-stickiness">
       <code class="parameter">trx_stickiness</code>
       <span class="type"><a href="language.types.string.html" class="type string">string</a></span>
      </dt>

      <dd>

       <p class="para">
        Política de adhesión de transacciones. Las políticas admitidas son:
        <em>disabled</em> (predeterminada), <em>master</em>.
       </p>
       <p class="para">
        Este ajuste requiere la versión 5.4.0 o posterior. Si se usa con una versión de PHP anterior a la 5.4.0,
        el complemetno emitirá una advertencia como <em>(mysqlnd_ms) trx_stickiness strategy is not supported before PHP 5.3.99</em>
        ((mysqlnd_ms) La estrategia trx_stickiness no está soportada antes de PHP 5.3.99).
       </p>
       <p class="para">
        Si no se establece ningun política de adhesión de transacciones o
        si se establece <em>trx_stickiness=disabled</em>,
        el complemento no considerará las transacciones. Por lo tanto, el complemento podrá realizar
        el equilibrado de carga de conexiones y el intercambio de conexiones en mitad de una trasacción.
        El complemento no es seguro con las transacciones. Se deben usar sugerencias SQL para
        evitar el intercambio de conexiones durante una transacción.
       </p>
       <p class="para">
        A partir de PHP 5.4.0, la bibliteca mysqlnd permite al complemento monitorizar
        el modo <em>autocommit</em> mediante las llamadas a la función
        <em>set_autocommit()</em> de la biblioteca.
        Si se establece <em>set_stickiness=master</em> y se deshabilita
        <em>autocommit</em> mediante una extensión de MySQL para PHP que
        invoque la llamada a la función interna <em>set_autocommit()</em>
        de la biblioteca <em>mysqlnd</em>, hará que el complemento
        considere el comienzo de una transacción. Luego, el complemento detiene el equilibrado de carga
        y dirige todas las setencias al servidor maestro hasta que
        <em>autocommit</em> sea habilitado. Por lo tanto, no son necesarias las sugerencias SQL.
       </p>
       <p class="para">
        Un ejemplo de una función de la API de MySQL para PHP que llama a la función interna
        <em>set_autocommit()</em> de la biblioteca <em>mysqlnd</em> es
        <span class="function"><a href="mysqli.autocommit.html" class="function">mysqli_autocommit()</a></span>.
       </p>
       <p class="para">
        Aunque se establezca <em>trx_stickiness=master</em>, el complemento
        no puede considerar los cambios del modo <em>autocommit</em> causados
        por sentencias SQL como <em>SET AUTOCOMMIT=0</em> o <em>BEGIN</em>.
       </p>
       <p class="para">
        A partir de PHP 5.5.0, la biblioteca mysqlnd introduce llamadas adicionales a la API en C para
        controlar transacciones. El nivel de control coincide con el ofrecido por sentencias
        SQL. La API <em>mysqli</em> ha sido modificada para usar
        dichas llamadas. Desde la versión 1.5.0, PECL/mysqlnd_ms puede monitorizar no solo
        <span class="function"><a href="mysqli.autocommit.html" class="function">mysqli_autocommit()</a></span>, sino también <span class="function"><strong>mysqli_begin()</strong></span>,
        <span class="function"><a href="mysqli.commit.html" class="function">mysqli_commit()</a></span> y <span class="function"><a href="mysqli.rollback.html" class="function">mysqli_rollback()</a></span> para
        detectar los límites de transacciones y detener el equilibrado de carga durante
        una transacción.
       </p>
       <p class="para">
        <div class="example" id="example-2061">
         <p><strong>Ejemplo #30 Utilizar el maestro para ejecutar transacciones</strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.78.136&quot;,
                &quot;port&quot;: &quot;3306&quot;
            }
        },
        &quot;trx_stickiness&quot;: &quot;master&quot;
    }
}</pre>
</div>
         </div>

        </div>
       </p>
       <p class="para">
        Desde la versión 1.5.0, la tolerancia a fallos automática y silenciosa está
        deshabilitada durante una transacción. Si los límites de una transacción han sido
        detectados apropiadamente, la adhesión de transacciones está habilitada y un servidor falla,
        el complemento no intentará realizar la tolerancia a fallos en el siguiente servidor, si lo hubiera,
        sin importar la configuración de la política de tolerancia a fallos. El usuario debe manejar el
        error de forma manual. Dependiendo de la configuración, el complemento podría emitir
        un error de tipo <em>E_WARNING</em> como
        <em>(mysqlnd_ms) Automatic failover is not permitted in the middle of a transaction</em>.
        Este error podría ser sobrescrito por errores siguientes como
        <em>(mysqlnd_ms) No connection selected by the last filter</em>.
        Esos errores serán generados por la función de consulta que falló.
       </p>
       <p class="para">
        <div class="example" id="example-2062">
         <p><strong>Ejemplo #31 Sin tolerancia a fallos automáticia, inconveniente al manejar errores</strong></p>
         <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;supuesto:&nbsp;configurada&nbsp;la&nbsp;tolerancia&nbsp;a&nbsp;fallos&nbsp;automática&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"myapp"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"username"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"database"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*&nbsp;establece&nbsp;el&nbsp;estado&nbsp;interno&nbsp;del&nbsp;complemento&nbsp;a&nbsp;in_trx&nbsp;=&nbsp;1&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">autocommit</span><span style="color: #007700">(</span><span style="color: #0000BB">false</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*&nbsp;supuesto:&nbsp;el&nbsp;servidor&nbsp;falla&nbsp;*/<br /></span><span style="color: #007700">if&nbsp;(!(</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;'Assume&nbsp;this&nbsp;query&nbsp;fails'&nbsp;AS&nbsp;_msg&nbsp;FROM&nbsp;DUAL"</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;</span><span style="color: #FF8000">/*&nbsp;manejar&nbsp;el&nbsp;fallo&nbsp;de&nbsp;la&nbsp;transacción,&nbsp;el&nbsp;estado&nbsp;interno&nbsp;del&nbsp;complemento&nbsp;aún&nbsp;es&nbsp;in_trx&nbsp;=&nbsp;1&nbsp;*/<br />&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"[%d]&nbsp;%s"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">errno</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error</span><span style="color: #007700">);<br />&nbsp;</span><span style="color: #FF8000">/*<br />&nbsp;&nbsp;Si&nbsp;se&nbsp;usa&nbsp;autocommit()&nbsp;basado&nbsp;en&nbsp;la&nbsp;detección&nbsp;de&nbsp;transacciones,&nbsp;es&nbsp;un<br />&nbsp;&nbsp;DEBER&nbsp;llamar&nbsp;a&nbsp;autocommit(true).&nbsp;De&nbsp;lo&nbsp;contrario&nbsp;el&nbsp;complemento&nbsp;asume<br />&nbsp;&nbsp;que&nbsp;la&nbsp;transacción&nbsp;actual&nbsp;continua&nbsp;y&nbsp;los&nbsp;cambios&nbsp;de<br />&nbsp;&nbsp;la&nbsp;conexión&nbsp;permanecen&nbsp;prohibidos.<br />&nbsp;*/<br />&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">autocommit</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />&nbsp;</span><span style="color: #FF8000">/*&nbsp;Igualmente,&nbsp;querrá&nbsp;iniciar&nbsp;una&nbsp;nueva&nbsp;transacción&nbsp;*/<br />&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">autocommit</span><span style="color: #007700">(</span><span style="color: #0000BB">false</span><span style="color: #007700">);<br />}<br /></span><span style="color: #FF8000">/*&nbsp;latin1&nbsp;de&nbsp;ahora&nbsp;en&nbsp;adelante&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">set_charset</span><span style="color: #007700">(</span><span style="color: #DD0000">"latin1"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
         </div>

        </div>
       </p>
       <p class="para">
        Si un servidor falla en mitad de una transacción, el complemento
        continua rechazando el intercambio de conexiones hasta que haya
        finalizado la transacción en curso. Recuerde que
        el complemento monitoriza las llamadas a la API para detectar los límites
        de las transacciones. Por tanto, se ha de, por ejemplo, habilitar
        el modo auto commit para finalizar la transacción actual antes de que
        el complemento continue equilibrando la carga e intercambiando el servidor.
        De igual modo, querrá iniciar una nueva transacción inmediantamente
        a partir de aquí y deshabilitar de nuevo el modo auto commit.
       </p>
       <p class="para">
        El no manejar las consultas fallidas y no finalizar una transacción fallida
        usando las llamadas a la API, podría causar que todos los comandos siguientes emitan errores
        como <em>Commands out of sync; you can&#039;t run this command now</em>.
        Por lo tanto, es importante manejar todos los errores.
       </p>
      </dd>

     
     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.transient_error">
       <code class="parameter">transient_error</code>
       <span class="type"><a href="language.types.object.html" class="type object">object</a></span>
      </dt>

      <dd>

       <p class="para">
        El ajuste ha sido introducido en la versión 1.6.0.
       </p>
       <p class="para">
        Un nodo de un clúster de una base de datos podría replicar un error transitorio a un cliente. El cliente
        puede entonces repetir la operación sobre el mismo nodo, recurrir a otro nodo diferente
        o abortar la operación. Por definición, es seguro que un cliente reintente
        la misma operación sobre el mismo nodo antes de rendirse.
       </p>
       <p class="para">
        <em>PECL/mysqlnd_ms</em> puede realizar el bucle de
        reintento en nombre de la aplicación.
        Configurando <em>transient_error</em>, el complemento puede ser
        instruido para que repita las operaciones que fallen con ciertos códigos de error para
        un número máximo de veces con una pausa entre cada reintento.
        Si el error transitorio desaparece durante la ejecución del bucle, se
        oculta a la aplicación. De lo contrario, el error es
        reenviado a la aplicación al finalizar el bucle.
       </p>
       <p class="para">
        <div class="example" id="example-2063">
         <p><strong>Ejemplo #32 Bucle de reintentos para errores transitorios</strong></p>
         <div class="example-contents">
<div class="inicode"><pre class="inicode">{
    &quot;myapp&quot;: {
        &quot;master&quot;: {
            &quot;master_0&quot;: {
                &quot;host&quot;: &quot;localhost&quot;
            }
        },
        &quot;slave&quot;: {
            &quot;slave_0&quot;: {
                &quot;host&quot;: &quot;192.168.78.136&quot;,
                &quot;port&quot;: &quot;3306&quot;
            }
       },
       &quot;transient_error&quot;: {
          &quot;mysql_error_codes&quot;: [
            1297
          ],
          &quot;max_retries&quot;: 2,
          &quot;usleep_retry&quot;: 100
       }
    }
}</pre>
</div>
         </div>

        </div>
       </p>
       <table class="doctable informaltable">
        
         <col width="1*" />
         <col width="7*" />
         <col width="2*" />
         <thead>
          <tr>
           <th>Palabra clave</th>
           <th>Descripción</th>
           <th>Versión</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td>
            <em>mysql_error_codes</em>
           </td>
           <td>
            <p class="para">
             La lista de los códigos de errores transitorios. Se podría añadir cualquier código de error de MySQL
             a la lista. Es posible considerar cualquier error como transitorio,
             no únicamente el <em>1297</em>
             (<em>HY000 (ER_GET_TEMPORARY_ERRMSG),
             Message: Got temporary error %d &#039;%s&#039; from %s</em>).
             Antes de añadir otros códigos, excepto el <em>1297</em>, a la lista,
             asegúrese de que el clúster admite un nuevo intento sin impactar
             sobre el estado de la aplicación.
            </p>
           </td>
           <td>Desde 1.6.0.</td>
          </tr>

          <tr>
           <td>
            <em>max_retries</em>
           </td>
           <td>
            <p class="para">
             Cuántas veces reintentar una operación que
             falla con un error transitorio antes de reenviar el
             fallo al usuario.
            </p>
            <p class="para">
             Predeterminado: <em>1</em>
            </p>
           </td>
           <td>Desde 1.6.0.</td>
          </tr>

          <tr>
           <td>
            <em>usleep_retry</em>
           </td>
           <td>
            <p class="para">
             Milisegundos a dormir antes de reintentar el error transitorio.
             El valor es pasado a la función <span class="function"><a href="function.usleep.html" class="function">usleep()</a></span> en C,
             de ahí el nombre.
            </p>
            <p class="para">
             Predeterminado: <em>100</em>
            </p>
           </td>
           <td>Desde 1.6.0.</td>
          </tr>

         </tbody>
        
       </table>

      </dd>

     
     
     
      <dt id="ini.mysqlnd-ms-plugin-config-v2.xa">
       <code class="parameter">xa</code>
       <span class="type"><a href="language.types.object.html" class="type object">object</a></span>
      </dt>

      <dd>

       <p class="para">
        Este ajuste ha sido introducido en la versión 1.6.0.
       </p>
       <p class="para">
        <blockquote class="note"><p><strong class="note">Nota</strong>: 
         <strong>Experimental</strong><br />
         <p class="para">
          Esta característica está actualmente en desarrollo. Podrían existir problemas y/o
          limitaciones. No la use en entornos de producción.
         </p>
        </p></blockquote>
       </p>
       <dl>

        
         <dt>
state_store</dt>

         <dd>

          <dl>

           
            <dt>
record_participant_credentials</dt>

            <dd>

             <p class="para">
              Si almacenar el nombre de usuario y la contraseña de un participante de una
              transacción global en la tabla de participantes. Si está desacivado, la recolección
              de basura utilizará el nombre de usuario y contraseña predeterminados al conectarse
              a los participantes. A menos que se esté utilizando un nombre de usuario y contraseña
              diferentes para cada servidor de MySQL, se pueden emplear los predeterminados
              y evitar el almacenamiento de información sensible en el almacén de estado.
             </p>
             <p class="para">
              Observe que el nombre de usuario y la contraseña se almacenan en texto claro al usar
              el almacén de estado de MySQL, el cual es el único disponible. Es su responsabilidad
              proteger esta información sensible.
             </p>
             <p class="para">
              Predeterminado: <em>false</em>
             </p>
            </dd>

           
           
            <dt>
participant_localhost_ip</dt>

            <dd>

             <p class="para">
              Durante la recolección de basura de XA, el complemento podría encontrar un servidor
              participante para el cual haya sido anotado el host
              <em>localhost</em>. Si la recolección de basura toma lugar en otro host
              que no sea que haya escrito el registro de participantes en el almacén de estado,
              el nombre de host <em>localhost</em> ahora se resuelve a un host
              diferente. Por tanto, al anotar un nombre de host de un servidor participante
              en el almacén de estado, un valor de <em>localhost</em> debe
              ser reemplazado con la dirección IP real de <em>localhost</em>.
             </p>
             <p class="para">
              El establecimiento de <em>participant_localhost_ip</em> solamente debería
              ser considerado si el empleo <em>localhost</em> no se puede evitar.
              Solamente desde el punto de vista de la recolección de basura, es preferible no
              configurar ninguna conexión de socket, sino porprocionar una dirección IP y un puerto
              para un nodo.
             </p>
            </dd>

           
           
            <dt>
mysql</dt>

            <dd>

             <p class="para">
              El almacén de estado de MySQL es el único almacén de estado disponible.
             </p>
             <dl>

              
               <dt>
global_trx_table</dt>

               <dd>

                <p class="para">
                 Nombre de la tabla de MySQL empleada para almacenar el estado de una transacción global
                 en curso o abortada. Use la sentencia SQL de abajo para para crear la tabla.
                 Asegúrese de editar el nombre de la tabla para que coincida con su configuración.
                </p>
                <p class="para">
                 Predeterminado: <em>mysqlnd_ms_xa_trx</em>
                </p>
                <p class="para">
                 <div class="example" id="example-2064">
                  <p><strong>Ejemplo #33 Definición SQL para la tabla de transacciones de almacenamiento de estado de MySQL</strong></p>
                  <div class="example-contents">
<div class="sqlcode"><pre class="sqlcode">CREATE TABLE mysqlnd_ms_xa_trx (
  store_trx_id int(11) NOT NULL AUTO_INCREMENT,
  gtrid int(11) NOT NULL,
  format_id int(10) unsigned NOT NULL DEFAULT &#039;1&#039;,
  state enum(&#039;XA_NON_EXISTING&#039;,&#039;XA_ACTIVE&#039;,&#039;XA_IDLE&#039;,&#039;XA_PREPARED&#039;,&#039;XA_COMMIT&#039;,&#039;XA_ROLLBACK&#039;) NOT NULL DEFAULT &#039;XA_NON_EXISTING&#039;,
  intend enum(&#039;XA_NON_EXISTING&#039;,&#039;XA_ACTIVE&#039;,&#039;XA_IDLE&#039;,&#039;XA_PREPARED&#039;,&#039;XA_COMMIT&#039;,&#039;XA_ROLLBACK&#039;) DEFAULT &#039;XA_NON_EXISTING&#039;,
  finished enum(&#039;NO&#039;,&#039;SUCCESS&#039;,&#039;FAILURE&#039;) NOT NULL DEFAULT &#039;NO&#039;,
  modified timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  started datetime DEFAULT NULL,
  timeout datetime DEFAULT NULL,
  PRIMARY KEY (store_trx_id),
  KEY idx_xa_id (gtrid,format_id,finished),
  KEY idx_state (state)
) ENGINE=InnoDB</pre>
</div>
                  </div>

                 </div>
                </p>
               </dd>

              
              
               <dt>
participant_table</dt>

               <dd>

                <p class="para">
                 Nombre de la tabla de MySQL empleada para almacenar los participantes de una transacción global
                 en curso o abortada. Use la sentencia SQL de abajo para para crear la tabla.
                 Asegúrese de editar el nombre de la tabla para que coincida con su configuración.
                </p>
                <p class="para">
                 Se pueden habilitar y deshabilitar el almacenamiento de credenciales con
                 <em>record_participant_credentials</em>
                </p>
                <p class="para">
                 Predeterminado: <em>mysqlnd_ms_xa_participants</em>
                </p>
                <div class="example" id="example-2065">
                 <p><strong>Ejemplo #34 Definición SQL para la tabla de transacciones de almacenamiento de estado de MySQL</strong></p>
                 <div class="example-contents">
<div class="sqlcode"><pre class="sqlcode">CREATE TABLE mysqlnd_ms_xa_participants (
  fk_store_trx_id int(11) NOT NULL,
  bqual varbinary(64) NOT NULL DEFAULT &#039;&#039;,
  participant_id int(10) unsigned NOT NULL AUTO_INCREMENT,
  server_uuid varchar(127) DEFAULT NULL,
  scheme varchar(1024) NOT NULL,
  host varchar(127) DEFAULT NULL,
  port smallint(5) unsigned DEFAULT NULL,
  socket varchar(127) DEFAULT NULL,
  user varchar(127) DEFAULT NULL,
  password varchar(127) DEFAULT NULL,
  state enum(&#039;XA_NON_EXISTING&#039;,&#039;XA_ACTIVE&#039;,&#039;XA_IDLE&#039;,&#039;XA_PREPARED&#039;,&#039;XA_COMMIT&#039;,&#039;XA_ROLLBACK&#039;)
   NOT NULL DEFAULT &#039;XA_NON_EXISTING&#039;,
  health enum(&#039;OK&#039;,&#039;GC_DONE&#039;,&#039;CLIENT ERROR&#039;,&#039;SERVER ERROR&#039;) NOT NULL DEFAULT &#039;OK&#039;,
  connection_id int(10) unsigned DEFAULT NULL,
  client_errno smallint(5) unsigned DEFAULT NULL,
  client_error varchar(1024) DEFAULT NULL,
  modified timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (participant_id),
  KEY idx_xa_bqual (bqual),
  KEY idx_store_trx (fk_store_trx_id),
  CONSTRAINT mysqlnd_ms_xa_participants_ibfk_1 FOREIGN KEY (fk_store_trx_id)
    REFERENCES mysqlnd_ms_xa_trx (store_trx_id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB</pre>
</div>
                 </div>

                </div>
               </dd>

              
              
               <dt>
garbage_collection_table</dt>

               <dd>

                <p class="para">
                 Nombre de la tabla de MySQL empleada para rastrear y sincronizar ejecuciones de recolección de basura.
                 en curso o abortada. Use la sentencia SQL de abajo para para crear la tabla.
                 Asegúrese de editar el nombre de la tabla para que coincida con su configuración.  
                </p>
                <p class="para">
                 Predeterminado: <em>mysqlnd_ms_xa_gc</em>
                </p>
                <div class="example" id="example-2066">
                 <p><strong>Ejemplo #35 Definición SQL para la tabla de transacciones de almacenamiento de estado de MySQL</strong></p>
                 <div class="example-contents">
<div class="sqlcode"><pre class="sqlcode">CREATE TABLE mysqlnd_ms_xa_gc (
  gc_id int(10) unsigned NOT NULL AUTO_INCREMENT,
  gtrid int(11) NOT NULL,
  format_id int(10) unsigned NOT NULL DEFAULT &#039;1&#039;,
  fk_store_trx_id int(11) DEFAULT NULL,
  modified timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  attempts smallint(5) unsigned NOT NULL DEFAULT &#039;0&#039;,
  PRIMARY KEY (gc_id),
  KEY idx_store_trx (gtrid,format_id,fk_store_trx_id)
) ENGINE=InnoDB</pre>
</div>
                 </div>

                </div>
               </dd>

              
              
               <dt>
host</dt>

               <dd>

                <p class="para">
                 Nombre de host del servidor de MySQL.
                </p>
               </dd>

              
              
               <dt>
user</dt>

               <dd>

                <p class="para">
                 Nombre del usuario empleado para conectarse al servidor de MySQL.
                </p>
               </dd>

              
              
               <dt>
password</dt>

               <dd>

                <p class="para">
                 Contraseña para el usuario del servidor de MySQL.
                </p>
               </dd>

              
              
               <dt>
db</dt>

               <dd>

                <p class="para">
                 Base de datos que guarda las tablas de recolección de basura.
                 Observe que se han de crear las tablas de recolección de
                 basura antes de utilzar el complemento. Las tablas no serán
                 creadas implícitamente durante el tiempo de ejecución, por lo que la recolección
                 de basura fallará si las tablas no existen.
                </p>
               </dd>

              
              
               <dt>
port</dt>

               <dd>

                <p class="para">
                 Puerto del servidor de MySQL.
                </p>
               </dd>

              
              
               <dt>
socket</dt>

               <dd>

                <p class="para">
                 Socket de dominio Unix del servidor de MySQL. Observe que
                 si se tiene variaor servidores de PHP, cada uno intentará
                 realizar la recolección de basura, siendo necesario que sean
                 capces de conectarse al almacén de estado. En este caso, podría ser
                 preferible configurar una dirección IP y un puerto para
                 el servidor de almancen de estado de MySQL para asegurarse de que los
                 servidores de PHP se pueden conectar a él.
                </p>
               </dd>

              
             </dl>

            </dd>

            
          </dl>

         </dd>

        
        
         <dt>
rollback_on_close</dt>

         <dd>

          <p class="para">
           Si revertir automáticamente una transacción global abierta cuando
           se cierre una conexión. Si está habilitado, imita el comportamiento predeterminado
           de las transacciones locales. Si un cliente se desconecta, el servidor revertirá
           cualquier transacción abierta y no finalizada.
          </p>
          <p class="para">
           Predeterminado: <em>true</em>
          </p>
         </dd>

        
        
         <dt id="ini.mysqlnd-ms-plugin-config-v2.xa.gc">garbage_collection</dt>

         <dd>

          <dl>

           
            <dt>
max_retries</dt>

            <dd>

             <p class="para">
              Número máximo de ejecuciones de la recolección de basura antes de rendirse.
              Los valores permitidos van de <em>0</em> hasta <em>100</em>.
              Un valor de <em>0</em> significa sin límite, a menos que
              el almacén de estado fuerce uno. Si el almacén fuerza un límite,
              se suponeque podría ser significativamente mayor de <em>100</em>.
              Disponible desde 1.6.0.
             </p>
             <p class="para">
              Obsérvese que es importante finalizar las transacciones XA
              fallidas dentro de un tiempo razonable para que los servidores participantes
              liberen recursos vinculados a la transacción. Es poco probable que la
              recolección de basura falle por un período grande siempre y
              cuando los servidores caídos estén disponibles de nuevo rápidamente.
              Todavía podría darse una situación donde se requiera la intervención
              humana debido a que la recolección de basura interna se detuvo o falló.
              En este caso, se podría comprobar primero si la transacción no se puede
              arreglar aún forzando a <span class="function"><a href="function.mysqlnd-ms-xa-gc.html" class="function">mysqlnd_ms_xa_gc()</a></span>
              para que ignore el ajuste, antes de tratarlo manualmente.
             </p>
             <p class="para">
              Predeterminado: <em>5</em>
             </p>
            </dd>

           
           
            <dt>
probability</dt>

            <dd>

             <p class="para">
              Probabilidad de la recolección de basura.
              Los valores permitidos van desde <em>0</em> a <em>1000</em>.
              Un valor de <em>0</em> deshabilita la recolección de basura
              automática en segundo plano. Aún estableciendo un valor de <em>0</em>,
              es posible ocasionar la recolección de basura llamando a
              <span class="function"><strong>mysqlnd_ms_gc()</strong></span>.
              Disponible desde 1.6.0.
             </p>
             <p class="para">
              La recolección de basura de transacciones XA obsoletas solamente está
              disponible si se ha configurado un almacén de estados. El almacén de estados
              es responsable de seguir la pista a las transacciones XA. Basándose en sus registros,
              puede encontrar transacciones XA bloqueadas a causa de la desconexión del cliente,
              conectarse a los participantes y revertir las transacciones no finalizadas.
             </p>
             <p class="para">
              La recolección de basura se desencadena como parte de un procedimiento de apagado
              de solicitud de PHP al final de una petición web. Esto es, después de haber finalizado
              el script de PHP. Para decidir si se ejecuta la recolección de basura
              se computa un valor aleatorio entre <em>0</em> y
              <em>1000</em>. Si el valor de <em>probability</em> es mayor
              o igual al valor aleatorio, se invocan a las rutinas de la recolección de basura
              del almacén de estados.
             </p>
             <p class="para">
              Predeterminado: <em>5</em>
             </p>
            </dd>

           
           
            <dt>
max_transactions_per_run</dt>

            <dd>

             <p class="para">
              Número máximo de transacciones XA no finalizadas consideradas
              por la recolección de basura durante una ejecución.
              Los valores permitidos van desde <em>1</em> hasta <em>32768</em>.
              Dsiponible desde 1.6.0.
             </p>
             <p class="para">
              Limpiar una transacción XA no finalizada toma una cantidad de tiempo
              y recursos considerables. La rutina de recolección de basura
              podría tener que conectarse a varios participantes de una transacción global
              fallida para enviar los comandos SQL necesarios para revertir
              la transacción no finalizada.
             </p>
             <p class="para">
              Predeterminado: <em>100</em>
             </p>
            </dd>

           
          </dl>

         </dd>

        
       </dl>

      </dd>

     
    </dl>

   </p>
  </div>
  
  <div class="section" id="mysqlnd-ms.plugin-ini-v1">
   <h2 class="title">Fichero de configuración del complemento (&lt;= 1.0.x)</h2>
   <blockquote class="note"><p><strong class="note">Nota</strong>: 
    <p class="para">
     La descripción de abajo se aplica a PECL/mysqlnd_ms &lt; 1.1.0-beta.
     No es válida para versiones posteriores.
    </p>
   </p></blockquote>
   <p class="para">
    El complemento usa su propio fichero de configuración. Éste
    guarda información sobre el servidor maestro de replicación MySQL,
    los servidores esclavos de replicación MySQL, la política de elección (equilibrado de carga),
    la estrategia de tolerancia a fallos, y el uso de conexiones retardadas.
   </p>
   <p class="para">
    La directiva de configuración de PHP
    <a href="mysqlnd-ms.configuration.html#ini.mysqlnd-ms.ini-file" class="link"><em>mysqlnd_ms.ini_file</em></a>
    se usa para establecer el fichero de configuración del complemento.
   </p>
   <p class="para">
    El fichero de configuración imita el estándar del formato de <em>php.ini</em>.
    Consiste en una o más secciones. Cada sección define su propia unidad
    de ajustes. No existe una sección global para ajustes globales.
   </p>
   <p class="para">
    Las aplicciones hacen referencia a las secciones por su nombre. Las aplicaciones usan los nombres de las
    secciones como el parámetro &#039;host&#039; (servidor) de los distintos métodos de conexión de las extensiones
    <a href="ref.mysqli.html" class="link">mysqli</a>,
    <a href="ref.mysql.html" class="link">mysql</a> y
    <a href="ref.pdo-mysql.html" class="link">PDO_MYSQL</a>. Durante la conexión,
    el complemento de <a href="book.mysqlnd.html" class="link">mysqlnd</a> compara el nombre del equipo anfitrión
    con todos los nombres de las secciones del fichero de configuración del complemento. Si el nombre del
    equipo anfitrión y el nombre de la sección coinciden, el complemento cargará la configuración de esa sección.
   </p>
   <p class="para">
    <div class="example" id="example-2067">
     <p><strong>Ejemplo #36 Ejemplo del uso de nombres de sección</strong></p>
     <div class="example-contents">
<div class="inicode"><pre class="inicode">[myapp]
master[] = localhost
slave[] = 192.168.2.27
slave[] = 192.168.2.28:3306
[localhost]
master[] = localhost:/tmp/mysql/mysql.sock
slave[] = 192.168.3.24:3305
slave[] = 192.168.3.65:3309</pre>
</div>
     </div>

     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;Todas&nbsp;las&nbsp;conexiones&nbsp;siguientes&nbsp;tendrán&nbsp;equilibrado&nbsp;de&nbsp;carga&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"myapp"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"nombre_usuario"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"contraseña"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"base_datos"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$pdo&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #DD0000">'mysql:host=myapp;dbname=base_datos'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'nombre_usuario'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'contraseña'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"myapp"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"nombre_usuario"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"contraseña"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"nombre_usuario"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"contraseña"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"base_datos"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
   </p>
   <p class="para">
    Los nombres de sección son cadenas de texto. Es válido usar nombres de sección como
    <em>192.168.2.1</em>, <em>127.0.0.1</em> o
    <em>localhost</em>. Si, por ejemplo, una aplicación
    se conexta a <em>localhost</em> y existe una sección de configuración
    del complemento llamada <em>[localhost]</em>, la
    semántica de la operación de conexión se cambia. La aplicación ya
    no usará únicamente el servidor MySQL que se ejecuta en el equipo anfitrión
    <em>localhost</em>, sino que el complemento iniciará el equilibrado de carga
    de las consultas MySQL siguiendo las reglas de la sección de configuración
    <em>[localhost]</em>. De esta manera se puede realizar el equilibrado de carga de consultas
    desde una aplicación sin cambiar el código fuente de la misma.
   </p>
   <p class="para">
    Las directivas de configuración <em>master[]</em>, <em>slave[]</em>
    y <em>pick[]</em> usan una sintaxis similar a una lista.
    Las directivas de configuración que admiten la sintaxis de lista pueden aparecer varias
    veces en la sección de configuración. El complemento mantiene el orden en el
    que aparecen las entradas cuando las interpreta. Por ejemplo,
    el ejemplo de abajo muestra dos directivas de configuración <em>slave[]</em>
    en la sección de configuración <em>[myapp]</em>.
    Si se realiza el equilibrado de carga rotativo para consultas de solo lectura, el complemento
    enviará la primera consulta de solo lectura al servidor MySQL
    <em>mysql_slave_1</em> ya que es el primero de la lista.
    La segunda consulta de solo lectura será enviada al servidor MySQL
    <em>mysql_slave_2</em> ya que es el segundo de la lista.
    Los resultados de las directivas de configuración que admiten la sintaxis de lista están ordenados
    de arriba a abajo según su aparación dentro de la sección de
    configuración.
   </p>
   <p class="para">
    <div class="example" id="example-2068">
     <p><strong>Ejemplo #37 Sintaxis de lista</strong></p>
     <div class="example-contents">
<div class="inicode"><pre class="inicode">[myapp]
master[] = mysql_master_server
slave[] = mysql_slave_1
slave[] = mysql_slave_2</pre>
</div>
     </div>

    </div>
   </p>
   <p class="para">
    He aquí una breve explicación de las directivas de configuración que se pueden usar.
   </p>
   <p class="para">
    <dl>

     
      <dt id="ini.mysqlnd-ms-plugin-config.master">
       <code class="parameter">master[]</code>
       <span class="type"><a href="language.types.string.html" class="type string">string</a></span>
      </dt>

      <dd>

       <p class="para">
        URI de un servidor maestro de replicación MySQL. El URI sigue la sintaxis
        <em>hostname[:port|unix_domain_socket]</em>.
       </p>
       <p class="para">
        El complemento admite el uso de un único servidor maestro.
       </p>
       <p class="para">
        Es obligatorio establece un servidor esclavo. El complemento notificará una
        advertencia sobre la conexión si el usuario ha fallado al proporcionar un servidor
        esclavo en la sección de configuración.
        La advertencia podría ser <em>(mysqlnd_ms) Cannot find master section in config</em>
        ((mysqlnd_ms) No se pudo encontrar una sección de maestros en la configuración).
        Además, el complemento puede establecer un código de error para el gestor de conexión tal como
        <em>HY000/2000 (CR_UNKNOWN_ERROR)</em>. El mensaje de error
        correspondiente depende de la configuración del lenguaje.
       </p>
      </dd>

     
     
      <dt id="ini.mysqlnd-ms-plugin-config.slave">
       <code class="parameter">slave[]</code>
       <span class="type"><a href="language.types.string.html" class="type string">string</a></span>
      </dt>

      <dd>

       <p class="para">
        URI de uno o más servidores esclavos de replicación MySQL. El URI sigue la sintaxis
        <em>hostname[:port|unix_domain_socket]</em>.
       </p>
       <p class="para">
        El complemento admite el uso de uno o más servidores esclavos.
       </p>
       <p class="para">
        Es oblligatorio establecer un servidor esclavo. El complemento notificará una
        advertencia sobre la conexión si el usuario ha fallado al proporcionar al menos un servidor
        esclavo en la sección de configuración.
        La advertencia podría ser <em>(mysqlnd_ms) Cannot find slaves section in config</em>
        ((mysqlnd_ms) No se pudo encontrar una sección de esclavos en la configuración).
        Además, el complemento puede establecer un código de error para el gestor de conexión tal como
        <em>HY000/2000 (CR_UNKNOWN_ERROR)</em>. El mensaje de error
        correspondiente depende de la configuración del lenguaje.
       </p>
      </dd>

     
     
      <dt id="ini.mysqlnd-ms-plugin-config.pick">
       <code class="parameter">pick[]</code>
       <span class="type"><a href="language.types.string.html" class="type string">string</a></span>
      </dt>

      <dd>

       <p class="para">
        La política de equilibrado de carga (selección de servidores). Políticas soportadas:
        <em>random</em>, <em>random_once</em> (predeterminada),
        <em>roundrobin</em>, <em>user</em>.
       </p>
       <p class="para">
        Si no se establece ninguna política de equilibrado de carga, el complemento usará como predeterminada
        <em>random_once</em>. La política <em>random_once</em>
        elige un servidor esclavo aleatorio al ejecutar la primera sentencia de
        solo lectura. Este servidor esclavo será utilizado para todas las sentencias de
        solo lectura hasta que finalice la ejecución del script de PHP.
       </p>
       <p class="para">
        La política <em>random</em> eligirá un servidor aleatorio siempre que
        se ejecute una sentencia de solo lectura.
       </p>
       <p class="para">
        Si se usa
        <em>roundrobin</em> el complemento iterará sobre la lista de
        servidores esclavos configurados para elegir uno para la ejecución de sentencias.
        Si el complemento alcanza el final de la lista, volverá al comienzo de la
        misma y eligirá el primer servidor esclavo configurado.
       </p>
       <p class="para">
        El establecimiento de más de una política de equilibrado de carga en una sección
        de configuración solamente tiene sentido si se usa <em>user</em>
        y <span class="function"><a href="function.mysqlnd-ms-set-user-pick-server.html" class="function">mysqlnd_ms_set_user_pick_server()</a></span> juntos. Si la llamada
        de retorno del usuario falla al elegir un servidor, el complemento volverá
        a la segunda política de equilibrado de carga cofigurada.
       </p>
      </dd>

     
     
      <dt id="ini.mysqlnd-ms-plugin-config.failover">
       <code class="parameter">failover</code>
       <span class="type"><a href="language.types.string.html" class="type string">string</a></span>
      </dt>

      <dd>

       <p class="para">
        Política de tolerancia de fallos. Políticas admitidas:
        <em>disabled</em> (predeterminada), <em>master</em>.
       </p>
       <p class="para">
        Si no se establece ninguna política de tolerancia a fallos, el complemento no realizará ninguna
        tolerancia a fallos automática (<em>failover=disabled</em>). Siempre que
        el complemento falle al conectarse a un servidor, emitirá una advertencia y
        establecerá el código y el mensaje del error de conexión. A partir de entonces, es responsabilidad
        de la aplicación manejar el error y, por ejemplo, reenviar la
        última sentencia para provocar la selección de otro servidor.
       </p>
       <p class="para">
        Si se usa <em>failover=master</em>, el complemento implícitamente
        usará la tolerancia a fallos de un esclavo. Por favor, revise la
        documentación de conceptos para informarse sobre los problemas y
        riesgos potenciales del uso de <em>failover=master</em>.
       </p>
      </dd>

     
     
      <dt id="ini.mysqlnd-ms-plugin-config.lazy-connections">
       <code class="parameter">lazy_connections</code>
       <span class="type"><a href="language.types.boolean.html" class="type bool">bool</a></span>
      </dt>

      <dd>

       <p class="para">
        Controla el uso de conexiones retardadas. Las conexiones retardadas
        son conexiones que no se abren antes de que un cliente envíe la primera
        conexión. Las conexiones retardadas son las predeterminadas.
       </p>
       <p class="para">
        Se recomeinda encarecidamente usar conexiones retardadas.
        Éstas ayudan a mantener bajo el número de conexiones abiertas.
        Si se desabilitan las conexiones retardas y, por ejemplo, se configura un servidor
        maestro de replicación MySQL y dos esclavos de replicación MySQL, el
        complemento abrirá tres conexiones en la primera llamada a la
        función de conexión, aunque la aplicación podría usar solamente la conexión
        maestra.
       </p>
       <p class="para">
        Las conexiones retardadas revelan un riesgo si se realizan un gran uso de acciones
        que cambian el estado de una conexión. El complemento no resolverá
        todas las acciones de cambio de estado de todas las conexiones de la agrupación de conexiones.
        Las pocas acciones resueltas son aplicadas solamente a conexiones ya
        abiertas. Las conexiones retardadas abiertas en el futuro no son afectadas.
        Si, por ejemplo, se cambia el conjunto de caracteres de la conexión usando una
        llamada a la API de MySQL para PHP, el complemento cambiará el conjunto de caracteres de todas
        las conexiones abiertas en uso. No recordraá el cambio del conjunto de caracteres
        para aplicarlo en las conexiones retardadas abiertas en el futuro. Como
        resultado, la agrupación de conexiones interna guardaría conexiones que usarían
        diferencites conjuntos de caracteres. Esto no es lo deseado. Recuerde que los conuntos
        de caracteres se toman en cuenta para el escapado.
       </p>
      </dd>

     
     
      <dt id="ini.mysqlnd-ms-plugin-config.master-on-write">
       <code class="parameter">master_on_write</code>
       <span class="type"><a href="language.types.boolean.html" class="type bool">bool</a></span>
      </dt>

      <dd>

       <p class="para">
        Si se establece, el complemento usará únicamente el servidor maestro después de que
        se haya ejecutado la primera sentencia en el maestro. Las aplicaciones
        aún pueden enviar sentencias a los esclavos usando sugerencias SQL para
        invalidar la decisión automática.
       </p>
       <p class="para">
        Este ajuste puede ser útil con la demora de replicación. Si una aplicación ejecuta
        un <em>INSERT</em>, el complemento usará, de manera predeterminada, el
        maestro para ejecutar todas las sentencias siguientes, incluidas las
        sentencias <em>SELECT</em>. Esto ayuda a evitar problemas con
        las lecturas desde los esclavos que no hayan replicado aún el
        <em>INSERT</em>.
       </p>
      </dd>

     
     
      <dt id="ini.mysqlnd-ms-plugin-config.trx-stickiness">
       <code class="parameter">trx_stickiness</code>
       <span class="type"><a href="language.types.string.html" class="type string">string</a></span>
      </dt>

      <dd>

       <p class="para">
        Política de adhesión de transacciones. Las políticas admitidas son:
        <em>disabled</em> (predeterminada), <em>master</em>.
       </p>
       <p class="para">
        Característica experimental.
       </p>
       <p class="para">
        Este ajuste requiere la versión 5.4.0 o posterior. Si se usa con una versión de PHP anterior a la 5.4.0,
        el complemetno emitirá una advertencia como <em>(mysqlnd_ms) trx_stickiness strategy is not supported before PHP 5.3.99</em>
        ((mysqlnd_ms) La estrategia trx_stickiness no está soportada antes de PHP 5.3.99).
       </p>
       <p class="para">
        Si no se establece ningun política de adhesión de transacciones o
        si se establece <em>trx_stickiness=disabled</em>,
        el complemento no considerará las transacciones. Por lo tanto, el complemento podrá realizar
        el equilibrado de carga de conexiones y el intercambio de conexiones en mitad de una trasacción.
        El complemento no es seguro con las transacciones. Se deben usar sugerencias SQL para
        evitar el intercambio de conexiones durante una transacción.
       </p>
       <p class="para">
        A partir de PHP 5.4.0, la bibliteca mysqlnd permite al complemento monitorizar
        el modo <em>autocommit</em> mediante las llamadas a la función
        <em>set_autocommit()</em> de la biblioteca.
        Si se establece <em>set_stickiness=master</em> y se deshabilita
        <em>autocommit</em> mediante una extensión de MySQL para PHP que
        invoque la llamada a la función interna <em>set_autocommit()</em>
        de la biblioteca <em>mysqlnd</em>, hará que el complemento
        considere el comienzo de una transacción. Luego, el complemento detiene el equilibrado de carga
        y dirige todas las setencias al servidor maestro hasta que
        <em>autocommit</em> sea habilitado. Por lo tanto, no son necesarias las sugerencias SQL.
       </p>
       <p class="para">
        Un ejemplo de una función de la API de MySQL para PHP que llama a la función interna
        <em>trx_autocommit()</em> de la biblioteca <em>mysqlnd</em> es
        <span class="function"><a href="mysqli.autocommit.html" class="function">mysqli_autocommit()</a></span>.
       </p>
       <p class="para">
        Aunque se establezca <em>ser_stickiness=master</em>, el complemento
        no puede considerar los cambios del modo <em>autocommit</em> causados
        por setnencias SQL como <em>SET AUTOCOMMIT=0</em>.
       </p>
      </dd>

     
    </dl>

   </p>
  </div>
  
  <div class="section" id="mysqlnd-ms.testing">
   <h2 class="title">Probar el complemento</h2>
   <blockquote class="note"><p><strong class="note">Nota</strong>: 
    <p class="para">
     Esta sección se aplica a la versión mysqlnd_ms 1.1.0 o posterior, no a la serie 1.0.
    </p>
   </p></blockquote>
   <p class="para">
    El conjunto de pruebas de PECL/mysqlnd_ms se encuentra en el directorio <var class="filename">tests/</var>
    de la distribución del código fuente. El conjunto de pruebas consiste en unas pruebas
    phpt estándar, que están descriptas en la página web de PHP Quality Assurance Teams.
   </p>
   <p class="para">
    La ejecución de las pruebas requiere configurar de uno a cuatro servidores MySQL. Algunas pruebas no se
    conectan a MySQL de ningún mofo. Otras requieren un servidor. Algunas requieren
    dos servidores distintos. En algunos casos se usan dos servidores para emular una
    configuración de replicación. En otros casos se requieren un maestro y un esclavo existentes de una
    configuración de replicación MySQL. Las pruebas intentarán detectar cuántos servidores
    y qué tipo de servidores se dan. Si no se encuentran los servidores requeridos, la
    prueba será saltada automáticamente.
   </p>
   <p class="para">
    Antes de ejecutar las pruebas, edite <var class="filename">tests/config.inc</var> para
    configurar los servidores MySQL a usar durante las mismas.
   </p>
   <p class="para">
    La configuracion más básica es como sigue.
    <div class="example-contents">
<div class="cdata"><pre>
 putenv(&quot;MYSQL_TEST_HOST=localhost&quot;);
 putenv(&quot;MYSQL_TEST_PORT=3306&quot;);
 putenv(&quot;MYSQL_TEST_USER=root&quot;);
 putenv(&quot;MYSQL_TEST_PASSWD=&quot;);
 putenv(&quot;MYSQL_TEST_DB=test&quot;);
 putenv(&quot;MYSQL_TEST_ENGINE=MyISAM&quot;);
 putenv(&quot;MYSQL_TEST_SOCKET=&quot;);

 putenv(&quot;MYSQL_TEST_SKIP_CONNECT_FAILURE=1&quot;);
 putenv(&quot;MYSQL_TEST_CONNECT_FLAGS=0&quot;);
 putenv(&quot;MYSQL_TEST_EXPERIMENTAL=0&quot;);

 /* replication cluster emulation */
 putenv(&quot;MYSQL_TEST_EMULATED_MASTER_HOST=&quot;. getenv(&quot;MYSQL_TEST_HOST&quot;));
 putenv(&quot;MYSQL_TEST_EMULATED_SLAVE_HOST=&quot;. getenv(&quot;MYSQL_TEST_HOST&quot;));

 /* real replication cluster */
 putenv(&quot;MYSQL_TEST_MASTER_HOST=&quot;. getenv(&quot;MYSQL_TEST_EMULATED_MASTER_HOST&quot;));
 putenv(&quot;MYSQL_TEST_SLAVE_HOST=&quot;. getenv(&quot;MYSQL_TEST_EMULATED_SLAVE_HOST&quot;));
</pre></div>
    </div>

   </p>
   <p class="para">
    <em>MYSQL_TEST_HOST</em>, <em>MYSQL_TEST_PORT</em> y
    <em>MYSQL_TEST_SOCKET</em> definen el nombre del equipo anfitrión,
    el puerto TCP/IP y el socket de dominio Unix del servidor de la base de datos predeterminado.
    <em>MYSQL_TEST_USER</em> y <em>MYSQL_TEST_PASSWD</em>
    contienen el usuario y la contraseña necesarios para conectarse a la base de datos o esquema
    configurado con <em>MYSQL_TEST_DB</em>. Todos los servidores
    configurados han de tener el mismo usuario de base de datos configurado para proporcionar el acceso a
    la base de datos de prueba.
   </p>
   <p class="para">
    Con la sintaxis <em>host</em>, <em>host:puerto</em> o <em>host:/ruta/al/socket</em>
    se puede establecer un equipo anfitrión, un equipo anfitrión y un puerto o un equipo anfitrión y un socket suplentes para
    cualquier servidor.
    <div class="example-contents">
<div class="cdata"><pre>
putenv(&quot;MYSQL_TEST_SLAVE_HOST=192.168.78.136:3307&quot;));
putenv(&quot;MYSQL_TEST_MASTER_HOST=myserver_hostname:/path/to/socket&quot;));
</pre></div>
    </div>

   </p>
  </div>
  
  <div class="section" id="mysqlnd-ms.debugging">
   <h2 class="title">Depuración y rastreo</h2>
   <p class="para">
    El registro de depuración de mysqlnd se puede usar para depurar y rastrear las actividades de
    PECL/mysqlnd_ms. Al igual que mysqlnd, PECL/mysqlnd_ms añade información de rastreo al
    fichero de depuración de la bibliteca mysqlnd. Por favor, lea la directiva de configuración
    <a href="mysqlnd.config.html#ini.mysqlnd.debug" class="link"><em>mysqlnd.debug</em></a>
    de PHP para una descripción detallada
    de cómo configurar el registro de depuración.
   </p>
   <p class="para">
    Ejemplo de ajuste de configuración para activar el registro de depuración:
    <div class="example-contents">
<div class="cdata"><pre>
mysqlnd.debug=d:t:x:O,/tmp/mysqlnd.trace
</pre></div>
    </div>

    <blockquote class="note"><p><strong class="note">Nota</strong>: 
     <p class="para">
      Esta característica solamente está disponible con una construcción de depuración de PHP. Funciona
      en Microsoft Windows si se usa una construcción de depuración de PHP y PHP fue
      compilado usando Microsoft Visual C versión 9 y superior.
     </p>
    </p></blockquote>
   </p>
   <p class="para">
    El registro de depuración muestra las llamadas a las funciones de la biblioteca mysqlnd y del complemento PECL/mysqlnd_ms,
    similar a un registro de rastreo. Las llamadas de la biblioteca mysqlnd normalmente están prefijadas con
    <em>mysqlnd_</em>. Las llamadas internas a PECL/mysqlnd comienzan con
    <em>mysqlnd_ms</em>.
   </p>
   <p class="para">
    Extracto de ejemplo del registro de depuración (conectar):
    <div class="example-contents">
<div class="cdata"><pre>
[...]
&gt;mysqlnd_connect
| info : host=myapp user=root db=test port=3306 flags=131072
| &gt;mysqlnd_ms::connect
| | &gt;mysqlnd_ms_config_json_section_exists
| | | info : section=[myapp] len=[5]
| | | &gt;mysqlnd_ms_config_json_sub_section_exists
| | | | info : section=[myapp] len=[5]
| | | | info : ret=1
| | | &lt;mysqlnd_ms_config_json_sub_section_exists
| | | info : ret=1
| | &lt;mysqlnd_ms_config_json_section_exists
[...]
</pre></div>
    </div>

   </p>
   <p class="para">
    El registro de depuración no sólo es útila para los desarrolladores del complemento, sino también para encontrar la
    causa de los errores ocurridos. Por ejemplo, si una aplicación no maneja apropiadamente
    los errores y falla al registrar mensajes de error, la revisión del registro de depuración
    y rastreo podría ayudar a encontrar la causa. El uso del registro de depuración
    para depurar problemas de una aplicación debería considerarse solamente si no está
    disponible ninguna otra opción. Escribir el registro de depuración en el disco es una operación
    lenta y podría tener un impacto negativo sobre el rendimiento de
    la aplicación.
   </p>
   <p class="para">
    Extracto de ejemplo del registro de depuración (fallo de conexión):
    <div class="example-contents">
<div class="cdata"><pre>
[...]
| | | | | | | info : adding error [Access denied for user &#039;root&#039;@&#039;localhost&#039; (using password: YES)] to the list
| | | | | | | info : PACKET_FREE(0)
| | | | | | | info : PACKET_FREE(0x7f3ef6323f50)
| | | | | | | info : PACKET_FREE(0x7f3ef6324080)
| | | | | | &lt;mysqlnd_auth_handshake
| | | | | | info : switch_to_auth_protocol=n/a
| | | | | | info : conn-&gt;error_info.error_no = 1045
| | | | | &lt;mysqlnd_connect_run_authentication
| | | | | info : PACKET_FREE(0x7f3ef63236d8)
| | | | | &gt;mysqlnd_conn::free_contents
| | | | | | &gt;mysqlnd_net::free_contents
| | | | | | &lt;mysqlnd_net::free_contents
| | | | | | info : Freeing memory of members
| | | | | | info : scheme=unix:///tmp/mysql.sock
| | | | | | &gt;mysqlnd_error_list_pdtor
| | | | | | &lt;mysqlnd_error_list_pdtor
| | | | | &lt;mysqlnd_conn::free_contents
| | | | &lt;mysqlnd_conn::connect
[...]
</pre></div>
    </div>

   </p>
   <p class="para">
    El registro de rastreo también se puede usar para verificar el comportamiento correcto
    del mismo PECL/mysqlnd_ms, por ejemplo, para comprobar qué servidor ha sido
    seleccionado para la ejecución de una consulta y por qué.
   </p>
   <p class="para">
    Extracto de ejemplo del registro de depuración (decisión del complemento):
    <div class="example-contents">
<div class="cdata"><pre>
[...]
&gt;mysqlnd_ms::query
| info : query=DROP TABLE IF EXISTS test
| &gt;_mysqlnd_plugin_get_plugin_connection_data
| | info : plugin_id=5
| &lt;_mysqlnd_plugin_get_plugin_connection_data
| &gt;mysqlnd_ms_pick_server_ex
| | info : conn_data=0x7fb6a7d3e5a0 *conn_data=0x7fb6a7d410d0
| | &gt;mysqlnd_ms_select_servers_all
| | &lt;mysqlnd_ms_select_servers_all
| | &gt;mysqlnd_ms_choose_connection_rr
| | | &gt;mysqlnd_ms_query_is_select
[...]
| | | &lt;mysqlnd_ms_query_is_select
[...]
| | | info : Init the master context
| | | info : list(0x7fb6a7d3f598) has 1
| | | info : Using master connection
| | | &gt;mysqlnd_ms_advanced_connect
| | | | &gt;mysqlnd_conn::connect
| | | | | info : host=localhost user=root db=test port=3306 flags=131072 persistent=0 state=0
</pre></div>
    </div>

   </p>
   <p class="para">
    En este caso, la sentencia <em>DROP TABLE IF EXISTS test</em> ha sido
    ejecutada. Observe que el string de la sentencia se muestra en el fichero de registro. Se podrían
    tomar medidas para restringir el acceso al registro por consideraciones de seguridad.
   </p>
   <p class="para">
    La sentencia ha sido equilibrada en carga usando la política de rotación (&#039;round robin&#039;),
    como se puede adivinar fácilmente del nombre de la función <em>&gt;mysqlnd_ms_choose_connection_rr</em>.
    Ha sido enviada a un servidor maestro que se ejecuta en
    <em>host=localhost user=root db=test port=3306 flags=131072 persistent=0 state=0</em>.
   </p>
  </div>
  
  <div class="section" id="mysqlnd-ms.monitoring">
   <h2 class="title">Monitorización</h2>
   <p class="para">
    La actividad del complemento se puede monitorizar usando el registro de rastreo de mysqlnd,
    las estadísticas de mysqlnd, las estadísticas del complemento mysqlnd_ms y herramientas de depuración externas de PHP.
    El uso del registro de rastreo debería limitarse a la depuración. Se recomienda
    usar las estadísticas del complemento para la monitorización.
   </p>
   <p class="para">
    La escritura de un registro de rastreo es una operación lenta. Si se usa una herramiento de depuración externa de PHP,
    consulte el manual del proveedor para el impacto de rendimiento y el
    tipo de información recopilada. En la mayoría de los casos, las herramientas de depuración externas
    proporcionarán pilas de llamadas. A menudo, es más difícil interpretar una pila de llamadas o un registro de rastreo
    que las estadísticas proporcionadas por el complemento.
   </p>
   <p class="para">
    Las estadísticas del complemento indican con qué frecuencia se ha usado un tipo de clúster (esclavo o maestro),
    por qué se ha usado el nodo, si se han usado conexiones retardadas y si se ha realizado una inyección de
    ID de transacciones global. La información de la monitorización proporcionada permite al
    usuario verificar las decisiones del complemento y planear los recursos del clúster basándose en el patrón de uso.
    La función <span class="function"><a href="function.mysqlnd-ms-get-stats.html" class="function">mysqlnd_ms_get_stats()</a></span>
    se usa para acceder a las estadísticas. Por favor, vea las descripciones de las funciones para obtener una lista
    de las estadísticas disponibles.
   </p>
   <p class="para">
    Las estadísticas se recopilan en función de cada proceso de PHP. Su alcance es un proceso de PHP.
    Dependiendo del modelo de desarrollo de PHP, un proceso puede servir una o múltiples peticiones web.
    Si se usa el modelo CGI, un proceso de PHP sirve una petición web. Si se usa FastCGI o
    modelos de servidores web prebifurcados, un modelo de PHP normalmente servirá múltiples peticiones web.
    Lo mismo ocurre en el caso de un servidor web con subprocesos. Observe que los hilos ejecutados
    en paralelo podrían actualizar las estadísticas en paralelo. Por lo tanto, si se usa un modelo de desarrolo
    de PHP con hilos, las estadísticas podrían ser modificadas por más de un script al mismo tiempo. Un
    script no puede depender del hecho de que vea solamente sus propios cambios realizados a las estadísticas.
   </p>
   <p class="para">
    <div class="example" id="example-2069">
     <p><strong>Ejemplo #38 Comprobar la actividad del complemento en un modelo de desarrollo sin hilos</strong></p>
     <div class="example-contents">
<div class="inicode"><pre class="inicode">mysqlnd_ms.enable=1
mysqlnd_ms.collect_statistics=1</pre>
</div>
     </div>

     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;Equilibrado&nbsp;de&nbsp;carga&nbsp;siguiendo&nbsp;las&nbsp;reglas&nbsp;de&nbsp;la&nbsp;sección&nbsp;"myapp"&nbsp;del&nbsp;fichero&nbsp;de&nbsp;configuración&nbsp;del&nbsp;complemento&nbsp;(no&nbsp;se&nbsp;muestra)&nbsp;*/<br /></span><span style="color: #0000BB">$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"myapp"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"nombre_usuario"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"contraseña"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"base_datos"</span><span style="color: #007700">);<br />if&nbsp;(</span><span style="color: #0000BB">mysqli_connect_errno</span><span style="color: #007700">())<br />&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Por&nbsp;supuesto,&nbsp;su&nbsp;manejo&nbsp;de&nbsp;errores&nbsp;es&nbsp;más&nbsp;agradable...&nbsp;*/<br />&nbsp;&nbsp;</span><span style="color: #007700">die(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"[%d]&nbsp;%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">mysqli_connect_errno</span><span style="color: #007700">(),&nbsp;</span><span style="color: #0000BB">mysqli_connect_error</span><span style="color: #007700">()));<br /><br /></span><span style="color: #0000BB">$stats_before&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysqlnd_ms_get_stats</span><span style="color: #007700">();<br />if&nbsp;(</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;'Read&nbsp;request'&nbsp;FROM&nbsp;DUAL"</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$res</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_all</span><span style="color: #007700">());<br />}<br /></span><span style="color: #0000BB">$stats_after&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysqlnd_ms_get_stats</span><span style="color: #007700">();<br />if&nbsp;(</span><span style="color: #0000BB">$stats_after</span><span style="color: #007700">[</span><span style="color: #DD0000">'use_slave'</span><span style="color: #007700">]&nbsp;&lt;=&nbsp;</span><span style="color: #0000BB">$stats_before</span><span style="color: #007700">[</span><span style="color: #DD0000">'use_slave'</span><span style="color: #007700">])&nbsp;{<br />&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Según&nbsp;las&nbsp;estadísticas,&nbsp;¡la&nbsp;petición&nbsp;de&nbsp;lectura&nbsp;no&nbsp;se&nbsp;ha&nbsp;ejecutado&nbsp;en&nbsp;un&nbsp;esclavo!"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
   </p>
   <p class="para">
    Las estadísticas se agregan para todas las actividades del complemento y todas las conexión manejadas por
    el mismo. No es posible indicar cuánto contribuye un gestor de conexión en particular
    para el total de las estadísticas.
   </p>
   <p class="para">
    Utilizar la función de PHP <span class="function"><a href="function.register-shutdown-function.html" class="function">register_shutdown_function()</a></span> o la
    directiva de configuración de PHP <em>auto_append_file</em> es
    posiblemente más sencillo para volcar las estadísticas, por ejemplo, a un fichero de registro cuando un script
    finaliza. En lugar de usar un fichero de registro, también es posible enviar las estadísticas
    a una herramienta externa de monitorización para su registro y visualización.
   </p>
   <p class="para">
    <div class="example" id="example-2070">
     <p><strong>Ejemplo #39 Registrar las estadístcias durante el cierre</strong></p>
     <div class="example-contents">
<div class="inicode"><pre class="inicode">mysqlnd_ms.enable=1
mysqlnd_ms.collect_statistics=1
error_log=/tmp/php_errors.log</pre>
</div>
     </div>

     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">check_stats</span><span style="color: #007700">()&nbsp;{<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$msg&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">str_repeat</span><span style="color: #007700">(</span><span style="color: #DD0000">"-"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">80</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$msg&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #0000BB">var_export</span><span style="color: #007700">(</span><span style="color: #0000BB">mysqlnd_ms_get_stats</span><span style="color: #007700">(),&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$msg&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #0000BB">str_repeat</span><span style="color: #007700">(</span><span style="color: #DD0000">"-"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">80</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;</span><span style="color: #0000BB">error_log</span><span style="color: #007700">(</span><span style="color: #0000BB">$msg</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">register_shutdown_function</span><span style="color: #007700">(</span><span style="color: #DD0000">"check_stats"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
   </p>
  </div>
 </div><hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="mysqlnd-ms.configuration.html">Configuraci&oacute;n en tiempo de ejecuci&oacute;n</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="mysqlnd-ms.constants.html">Constantes predefinidas</a></div>
 <div class="up"><a href="mysqlnd-ms.setup.html">Instalaci&oacute;n/Configuraci&oacute;n</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
