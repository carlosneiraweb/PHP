<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Ejemplos con tres tablas</title>

 </head>
 <body><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="sdodasrel.examples.two-table.html">Ejemplos con dos tablas</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="sdodasrel.limitations.html">Limitations</a></div>
 <div class="up"><a href="sdodasrel.examples.html">Ejemplos</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="sdodasrel.examples.three-table" class="section">
  <h2 class="title">Ejemplos con tres tablas</h2>
  <p class="para">
   Los siguientes ejemplos usan tres tablas de la base de datos compañía:
   las tablas compañía, departamento y empleado. Estas introducen la pieza
   final de la función no ejercitada por los ejemplo anteriores: la
   referencia de no contención
   <var class="varname"><var class="varname">empleado_del_mes</var></var>.
  </p>
  <p class="para">
   Al igual que en los ejemplo de arraiba para la compañía y el departamento, este conjunto de ejemplos
   intentan ilustrar el ciclo de vida completo de un grafo de datos.
  </p>


  <p class="para">
   <div class="example" id="example-6026">
    <p><strong>Ejemplo #1 Una compañía, un departamento, un empleado - Crear</strong></p>
    <div class="example-contents"><p>
     En este ejemplo se crea una compañía que contiene un departamento y
     sólo un empleado. Observe que este ejemplo limpia las tres tablas
     al inicio, por lo que se conocerán los resultados exactos de las consultas.
    </p></div>
    <div class="example-contents"><p>
     Observe cómo una vez ha sido creados la compañía, el departamento y el empleado,
     se puede hacer que la propiedad
     <var class="varname"><var class="varname">empleado_del_mes</var></var>
     de la compañía apunte al nuevo empleado.
     Ya que esta propiedad es una referencia de no contención, no puede hacerse hasta
     que el objeto empleado haya sido creado dentro del grafo.
     Las referencias de no contención necesitan ser manejadas cuidadosamente.
     Por ejemplo, si el empleado ahora fuera eliminado del departamento al que pertenece,
     no sería correcto intentar guardar el grafo sin
     primero limpiar o reasignar la propiedad
     <var class="varname"><var class="varname">empleado_del_mes</var></var>
     .
     La regla de cierre de los grafos de datos de SDO requiere que cualquier objeto que sea
     apuntado por una referencia de no contención también debe ser alcanzable por
     relaciones de contención.
    </p></div>
    <div class="example-contents"><p>
     Cuando se va a insertar el grafo en la base de datos, el procedimiento
     es similar al ejemplo de insertar la compañía y el departamento,
     excepto que
     <var class="varname"><var class="varname">empleado_del_mes</var></var>
     introduce complejidad extra.
     El DAS Relacional necesita insertar los objetos bajando por el árbol
     formado por las relaciones de contención, compañía, luego departamento, y luego
     empleado. Esto es necesario por lo que siempre tiene la clave primaria
     autogenerada de un padre a mano para incluir una fila hija. Pero cuando
     se inserta la fila de la compañía, el empleado que es empleado del mes
     aún no ha sido insertado y la clave primaria no se conoce. El
     procedimiento es que después de insertar el registro del empleado y se
     conoce su clave primaria, se lleva a cabo un paso final en el que el
     registro de la compañía se actualiza con la clave primaria del empleado.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">require_once&nbsp;</span><span style="color: #DD0000">'SDO/DAS/Relational.php'</span><span style="color: #007700">;<br />require_once&nbsp;</span><span style="color: #DD0000">'company_metadata.inc.php'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">/*************************************************************************************<br />*&nbsp;Empty&nbsp;out&nbsp;the&nbsp;three&nbsp;tables<br />*************************************************************************************/<br /></span><span style="color: #0000BB">$gbd&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO_DSN</span><span style="color: #007700">,</span><span style="color: #0000BB">DATABASE_USER</span><span style="color: #007700">,</span><span style="color: #0000BB">DATABASE_PASSWORD</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$sentencia_pdo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$gbd</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'DELETE&nbsp;FROM&nbsp;COMPAÑÍA;'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$filas_afectadas&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sentencia_pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$sentencia_pdo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$gbd</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'DELETE&nbsp;FROM&nbsp;DEPARTAMENTO;'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$filas_afectadas&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sentencia_pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$sentencia_pdo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$gbd</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">'DELETE&nbsp;FROM&nbsp;EMPLEADO;'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$filas_afectadas&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sentencia_pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">/*************************************************************************************<br />*&nbsp;Crear&nbsp;una&nbsp;diminuta&nbsp;pero&nbsp;completa&nbsp;compañía.<br />*&nbsp;El&nbsp;nombre&nbsp;de&nbsp;la&nbsp;compañía&nbsp;es&nbsp;Acme.<br />*&nbsp;Existe&nbsp;un&nbsp;departamento,&nbsp;Zapatos.<br />*&nbsp;Existe&nbsp;un&nbsp;empleado,&nbsp;Sue.<br />*&nbsp;El&nbsp;empleado&nbsp;del&nbsp;mes&nbsp;es&nbsp;Sue.<br />*************************************************************************************/<br /></span><span style="color: #0000BB">$das&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">SDO_DAS_Relational&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$metadatos_bd</span><span style="color: #007700">,</span><span style="color: #DD0000">'compañía'</span><span style="color: #007700">,</span><span style="color: #0000BB">$metadatos_contenedor_SDO</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$gbd&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO_DSN</span><span style="color: #007700">,</span><span style="color: #0000BB">DATABASE_USER</span><span style="color: #007700">,</span><span style="color: #0000BB">DATABASE_PASSWORD</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$raíz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$das&nbsp;&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">createRootDataObject</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$acme&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$raíz&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">createDataObject</span><span style="color: #007700">(</span><span style="color: #DD0000">'compañía'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$acme&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">nombre&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Acme"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$zapatos&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$acme&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">createDataObject</span><span style="color: #007700">(</span><span style="color: #DD0000">'departamento'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$zapatos&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">nombre&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Zapatos'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$zapatos&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">ubicación&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'A-block'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$sue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$zapatos&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">createDataObject</span><span style="color: #007700">(</span><span style="color: #DD0000">'employee'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$sue&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">nombre&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Sue'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$acme&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">empleado_del_mes&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sue</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$das&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">applyChanges</span><span style="color: #007700">(</span><span style="color: #0000BB">$gbd</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$raíz</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Escritos&nbsp;Acme&nbsp;con&nbsp;un&nbsp;departamento&nbsp;y&nbsp;un&nbsp;empleado\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
   <div class="example" id="example-6027">
    <p><strong>Ejemplo #2 Una compañía, un departamento, un empleado - Recuperar y actualizar</strong></p>
    <div class="example-contents"><p>
     La sentencia SQL pasada al DAS Relacional esta vez es una unión
     interna que recupera datos de las tres tablas. De otro modo este ejemplo
     no introduciría nada que ya no apareciera en los ejemplos anteriores.
    </p></div>
    <div class="example-contents"><p>
     El grafo se actualiza por la adición de un nuevo departamento y un nuevo empleado,
     y algunas alteraciones en las propiedades nombre de los objetos existentes
     en el grafo. Los cambios combinados son luego escritos. El
     DAS Relacional procesará y aplicará una mezcla arbitraria de
     adicioines, modificaciones y eliminaciones hacia y desde el grafo de datos.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">require_once&nbsp;</span><span style="color: #DD0000">'SDO/DAS/Relational.php'</span><span style="color: #007700">;<br />require_once&nbsp;</span><span style="color: #DD0000">'company_metadata.inc.php'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">/*************************************************************************************<br />*&nbsp;Buscar&nbsp;otra&nbsp;vez&nbsp;la&nbsp;compañía&nbsp;y&nbsp;cambiar&nbsp;varios&nbsp;aspectos.<br />*&nbsp;Cambiar&nbsp;el&nbsp;nombre&nbsp;de&nbsp;la&nbsp;compañía,&nbsp;del&nbsp;departamento&nbsp;y&nbsp;del&nbsp;empleado.<br />*&nbsp;Añadir&nbsp;un&nbsp;segundo&nbsp;departamento&nbsp;y&nbsp;un&nbsp;nuevo&nbsp;empleado.<br />*&nbsp;Cambiar&nbsp;el&nbsp;empleado&nbsp;del&nbsp;mes.<br />*************************************************************************************/<br /></span><span style="color: #0000BB">$das&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">SDO_DAS_Relational&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$metadatos_bd</span><span style="color: #007700">,</span><span style="color: #DD0000">'compañía'</span><span style="color: #007700">,</span><span style="color: #0000BB">$metadatos_contenedor_SDO</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$gbd&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO_DSN</span><span style="color: #007700">,</span><span style="color: #0000BB">DATABASE_USER</span><span style="color: #007700">,</span><span style="color: #0000BB">DATABASE_PASSWORD</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$raíz&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$das</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">executeQuery</span><span style="color: #007700">(</span><span style="color: #0000BB">$gbd</span><span style="color: #007700">,<br />&nbsp;&nbsp;</span><span style="color: #DD0000">"select&nbsp;c.id,&nbsp;c.nombre,&nbsp;c.empleado_del_mes,&nbsp;d.id,&nbsp;d.nombre,&nbsp;e.id,&nbsp;e.nombre&nbsp;"&nbsp;</span><span style="color: #007700">.<br />&nbsp;&nbsp;</span><span style="color: #DD0000">"from&nbsp;compañía&nbsp;c,&nbsp;departamento&nbsp;d,&nbsp;empleado&nbsp;e&nbsp;"&nbsp;</span><span style="color: #007700">.<br />&nbsp;&nbsp;</span><span style="color: #DD0000">"where&nbsp;e.id_dept&nbsp;=&nbsp;d.id&nbsp;and&nbsp;d.id_comp&nbsp;=&nbsp;c.id&nbsp;and&nbsp;c.nombre='Acme'"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'compañía.id'</span><span style="color: #007700">,</span><span style="color: #DD0000">'compañía.nombre'</span><span style="color: #007700">,</span><span style="color: #DD0000">'compañía.empleado_del_mes'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'departamento.id'</span><span style="color: #007700">,</span><span style="color: #DD0000">'departamento.nombre'</span><span style="color: #007700">,</span><span style="color: #DD0000">'empleado.id'</span><span style="color: #007700">,</span><span style="color: #DD0000">'empleado.nombre'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">$acme&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$raíz</span><span style="color: #007700">[</span><span style="color: #DD0000">'compañía'</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br /><br /></span><span style="color: #0000BB">$zapatos&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$acme</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">departamento</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$sue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$zapatos&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">employee</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br /><br /></span><span style="color: #0000BB">$ti&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$acme</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createDataObject</span><span style="color: #007700">(</span><span style="color: #DD0000">'departamento'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$ti</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nombre&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'TI'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$ti</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">ubicación&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'G-block'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$billy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$ti</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createDataObject</span><span style="color: #007700">(</span><span style="color: #DD0000">'empleado'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$billy</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nombre&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Billy'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$acme</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nombre&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'MegaCorp'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$zapatos</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nombre&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Calzado'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$sue</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nombre&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Susan'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$acme</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">empleado_del_mes&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$billy</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$das&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">applyChanges</span><span style="color: #007700">(</span><span style="color: #0000BB">$gbd</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$raíz</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"Escritos&nbsp;la&nbsp;compañía&nbsp;con&nbsp;un&nbsp;departamento&nbsp;y&nbsp;un&nbsp;empleado&nbsp;extras&nbsp;y&nbsp;cambiados&nbsp;los&nbsp;nombres&nbsp;(Megacorp/Calzado/Susan)\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
   <div class="example" id="example-6028">
    <p><strong>Ejemplo #3 Una compañía, dos departamentos, dos empleados - Recuperar y eliminar</strong></p>
    <div class="example-contents"><p>
     La compañía se recupera como un grafo de datos completo que contiene cinco
     objetos de datos - la compañía, dos departamentos y  dos empleados.
     Se eliminan todos eliminando el objeto compañía. Al eliminar un
     objeto de grafo se eliminan todos los objetos bajo él en el grafo.
     Se generarán y ejecutarán cinco sentencias DELETE de SQL. Ya que siempre
     estarán cualificadas con una cláusula WHERE que contiene todos los
     campos que fueron recuperados, cualquier actualización en los datos de la
     base de datos en el transcurso de otro proceso será detectada.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">require_once&nbsp;</span><span style="color: #DD0000">'SDO/DAS/Relational.php'</span><span style="color: #007700">;<br />require_once&nbsp;</span><span style="color: #DD0000">'company_metadata.inc.php'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">/*************************************************************************************<br />*&nbsp;Ahora&nbsp;leerla&nbsp;una&nbsp;vez&nbsp;más&nbsp;y&nbsp;eliminarla.<br />*&nbsp;Se&nbsp;puede&nbsp;eliminar&nbsp;parte,&nbsp;aplicar&nbsp;los&nbsp;cambios,&nbsp;y&nbsp;luego&nbsp;seguir&nbsp;trabajando&nbsp;con&nbsp;el&nbsp;mismo<br />*&nbsp;grafo,&nbsp;pero&nbsp;se&nbsp;ha&nbsp;de&nbsp;tener&nbsp;cuidado&nbsp;de&nbsp;mantener&nbsp;el&nbsp;cierre&nbsp;-&nbsp;no&nbsp;se&nbsp;puede&nbsp;eliminar&nbsp;el<br />*&nbsp;empleado&nbsp;que&nbsp;es&nbsp;emplado&nbsp;del&nbsp;mes&nbsp;sin&nbsp;reasignar.&nbsp;Por&nbsp;seguridad,&nbsp;aquí&nbsp;se&nbsp;elimina&nbsp;la<br />*&nbsp;compañía&nbsp;de&nbsp;una&nbsp;sola&nbsp;vez.<br />*************************************************************************************/<br /></span><span style="color: #0000BB">$das&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">SDO_DAS_Relational&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$metadatos_bd</span><span style="color: #007700">,</span><span style="color: #DD0000">'compañía'</span><span style="color: #007700">,</span><span style="color: #0000BB">$metadatos_contenedor_SDO</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$gbd&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO_DSN</span><span style="color: #007700">,</span><span style="color: #0000BB">DATABASE_USER</span><span style="color: #007700">,</span><span style="color: #0000BB">DATABASE_PASSWORD</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$raíz&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$das</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">executeQuery</span><span style="color: #007700">(</span><span style="color: #0000BB">$gbd</span><span style="color: #007700">,<br />&nbsp;&nbsp;</span><span style="color: #DD0000">"select&nbsp;c.id,&nbsp;c.nombre,&nbsp;c.empleado_del_mes,&nbsp;d.id,&nbsp;d.nombre,&nbsp;e.id,&nbsp;e.nombre&nbsp;"&nbsp;</span><span style="color: #007700">.<br />&nbsp;&nbsp;</span><span style="color: #DD0000">"from&nbsp;compañía&nbsp;c,&nbsp;departamento&nbsp;d,&nbsp;empleado&nbsp;e&nbsp;"&nbsp;</span><span style="color: #007700">.<br />&nbsp;&nbsp;</span><span style="color: #DD0000">"where&nbsp;e.id_dept&nbsp;=&nbsp;d.id&nbsp;and&nbsp;d.id_comp&nbsp;=&nbsp;c.id&nbsp;and&nbsp;c.nombre='MegaCorp';"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'compañía.id'</span><span style="color: #007700">,</span><span style="color: #DD0000">'compañía.nombre'</span><span style="color: #007700">,</span><span style="color: #DD0000">'compañía.empleado_del_mes'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'departamento.id'</span><span style="color: #007700">,</span><span style="color: #DD0000">'departamento.nombre'</span><span style="color: #007700">,</span><span style="color: #DD0000">'empleado.id'</span><span style="color: #007700">,</span><span style="color: #DD0000">'empleado.nombre'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">$megacorp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$raíz</span><span style="color: #007700">[</span><span style="color: #DD0000">'compañía'</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br /><br />unset(</span><span style="color: #0000BB">$raíz</span><span style="color: #007700">[</span><span style="color: #DD0000">'compañía'</span><span style="color: #007700">]);<br /></span><span style="color: #0000BB">$das&nbsp;</span><span style="color: #007700">-&gt;&nbsp;</span><span style="color: #0000BB">applyChanges</span><span style="color: #007700">(</span><span style="color: #0000BB">$gbd</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$raíz</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Eliminados&nbsp;la&nbsp;compañía,&nbsp;departamentos&nbsp;y&nbsp;empleados&nbsp;de&nbsp;una&nbsp;sola&nbsp;vez.\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div><hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="sdodasrel.examples.two-table.html">Ejemplos con dos tablas</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="sdodasrel.limitations.html">Limitations</a></div>
 <div class="up"><a href="sdodasrel.examples.html">Ejemplos</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
